(function(){var h={}.hasOwnProperty,g=function(b,c){function e(){this.constructor=b}for(var f in c)h.call(c,f)&&(b[f]=c[f]);e.prototype=c.prototype;b.prototype=new e;b.__super__=c.prototype;return b};(function(b){return _.extend(b.Validation.validators,{minMultichoiceOptions:function(b){return function(b,c,g,d){return"multi-choice"===d.get("field_type")&&b.size()<g}}(this)})})(Backbone);this.Qapp.module("Entities",function(b,c,e,f,h,d){var k;b.EntryField=function(b){function a(){return a.__super__.constructor.apply(this,
arguments)}g(a,b);a.prototype.urlRoot=Routes.entry_fields_path();a.prototype.paramRoot="entry_field";a.prototype.blacklist=["index","editable","ok"];a.prototype.relations=[{type:e.Many,key:"entry_values",collectionType:""+c.Qodiag.namespace+".Entities.EntryValues",relatedModel:function(){return c.Entities.EntryValue}},{type:e.Many,key:"entry_field_options",collectionType:""+c.Qodiag.namespace+".Entities.EntryFieldOptions",relatedModel:function(){return c.Entities.EntryFieldOption}}];a.prototype.initialize=
function(){this.url=function(){return this.isNew()?this.urlRoot:""+this.urlRoot+"/"+this.id};d.isEmpty(this.get("entry_field_options"))||(this.listenTo(this.get("entry_field_options"),"options:add",this.addOption),this.listenTo(this.get("entry_field_options"),"options:remove",this.removeOption),this.listenTo(this,"option:selected",this.selectOption));return a.__super__.initialize.apply(this,arguments)};a.prototype.removeOption=function(a,b){return this.get("entry_values").removeEntryFieldOption(b)};
a.prototype.addOption=function(a,b){return this.get("entry_values").addEntryFieldOption(b)};a.prototype.selectOption=function(a,b){return this.get("entry_values").selectEntryFieldOption(b)};return a}(b.Model);b.EntryFields=function(c){function a(){return a.__super__.constructor.apply(this,arguments)}g(a,c);a.prototype.model=b.EntryField;a.prototype.initialize=function(b,c){this.sectionId=c.sectionId;this.entrySetId=c.entrySetId;this.url=function(){return this.sectionId?Routes.section_entry_fields_path(this.sectionId):
Routes.entry_fields_path()};return a.__super__.initialize.apply(this,arguments)};a.prototype.comparator=function(a){return d(a.get("title")).capitalize()};a.prototype.getSearchCollection=function(){return this.searchCollection};a.prototype.getLiveCollection=function(){return this.liveCollection};a.prototype.createSearchCollection=function(a){null==a&&(a=[]);d.isEmpty(a)||this.remove(this.filter(function(b){return d.contains(a,b.id)}));this.liveCollection=window.queryEngine.createLiveCollection(this.models);
this.liveCollection.setComparator(function(a){return d(a.get("title")).capitalize()});this.on("search:update",function(a){return this.updateSearchCollection(a)});return this.searchCollection=this.liveCollection.createLiveChildCollection().setFilter("search",function(a,b){return null==b||3>(null!=b?b.length:void 0)?!0:queryEngine.createSafeRegex(b).test(a.get("title"))}).query()};a.prototype.updateSearchCollection=function(a){return this.searchCollection.setSearchString(a).query()};return a}(b.Collection);
k={getEntryFieldEntities:function(c){c=new b.EntryFields([],d.omit(c,"callback"));c.fetch({reset:!0});return c}};return c.reqres.setHandler("entry:fields:entities",function(b){null==b&&(b={});return k.getEntryFieldEntities(b)})})}).call(this);
