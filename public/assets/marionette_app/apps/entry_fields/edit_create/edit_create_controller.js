(function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};this.Qapp.module("EntryFieldsApp.EditCreate",function(EditCreate,App,Backbone,Marionette,$,_){var _ref;return EditCreate.Controller=(function(_super){__extends(Controller,_super);function Controller(){_ref=Controller.__super__.constructor.apply(this,arguments);return _ref}Controller.prototype.initialize=function(options){return this.activeView=options.activeView,this.collection=options.collection,this.model=options.model,options};Controller.prototype.create=function(){return this.showDialog(new App.Entities.EntryField({editable:true}))};Controller.prototype.edit=function(){return this.showDialog(this.model)};Controller.prototype.showDialog=function(field){var dialogView,_this=this;dialogView=new EditCreate.Field({model:field});App.dialogRegion.show(dialogView);this.listenTo(dialogView,"save:clicked",function(options){return field.save(field.attributes)});this.listenTo(field,"created",function(){_this.addAsSorted(field,_this.collection);return dialogView.trigger("dialog:close")});return this.listenTo(field,"updated",function(){return dialogView.trigger("dialog:close")})};Controller.prototype.addAsSorted=function(model,collection){var index,parent;parent=collection.getParentCollection();index=_.sortedIndex(parent.pluck("title"),model.get("title"));parent.add(model,{at:index});return collection.trigger("reset")};return Controller})(App.Controllers.Base)})}).call(this);