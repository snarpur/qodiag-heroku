(function(){var h={}.hasOwnProperty,k=function(d,c){function f(){this.constructor=d}for(var e in c)h.call(c,e)&&(d[e]=c[e]);f.prototype=c.prototype;d.prototype=new f;d.__super__=c.prototype;return d};this.Qapp.module("EntrySetResponsesApp.Edit",function(d,c,f,e,h,g){return d.Controller=function(e){function b(){return b.__super__.constructor.apply(this,arguments)}k(b,e);b.prototype.initialize=function(a){c.contentRegion.show(this.getLayout(a));return this.executeSettingsNavigation()};b.prototype.edit=
function(a){return this.getSections(a)};b.prototype.getSections=function(a){var b,d;b=a.entrySetResponseId;d=a.sectionId;c.request("get:current:user");this.entrySetResponse=c.request("entry:set:response:entities",{id:b});return c.execute("when:fetched",this.entrySetResponse,function(a){return function(){a.sections=a.entrySetResponse.get("entry_set").get("sections");d&&a.sections.trigger("change:current:section",{model:a.sections.get(d)});a.showFormSteps();if(0!==a.sections.length)return a.listenTo(a.sections,
"change:current:section",function(){c.navigate(a.sectionUrl(),{replace:!0});return a.getEntries()}),a.getEntries()}}(this))};b.prototype.getEntries=function(){var a;a=this.entrySetResponse.getSectionResponses();return c.execute("when:fetched",a,function(b){return function(){b.entrySetResponse.set("entry_fields",a);return b.showForm()}}(this))};b.prototype.executeSettingsNavigation=function(){return c.execute("show:settings:navigation",{iconClass:"fa fa-envelope",i18n:"views.responder_items.requests.name"})};
b.prototype.showFormSteps=function(){var a;a=this.getFormStepsView({collection:this.sections});return this.show(a,{region:this.getFormStepsRegion(),loading:!1})};b.prototype.showForm=function(){var a,b;a=this.getFormView();b=c.request("form:wrapper",a,this.buttonsConfig());this.show(b,{region:this.getFormWrapperRegion(),loading:!0});this.listenTo(b,"form:back",function(a){return function(){return a.sections.trigger("change:current:section",{model:a.sections.getPreviousSection()})}}(this));this.listenTo(b,
"form:saveAndContinue",function(a){return function(){return a.saveAndMoveToNextSection(b)}}(this));return this.listenTo(b,"form:saveAndComplete",function(a){return function(){return a.saveAsCompleteAndRedirect(b)}}(this))};b.prototype.saveAsCompleteAndRedirect=function(a){this.entrySetResponse.set("entry_values",this.entrySetResponse.getEntryValuesForSection());this.entrySetResponse.set("complete_item",1);a.trigger("form:submit");return this.listenToOnce(this.entrySetResponse,"updated",function(a){return function(){c.navigate("/items",
{trigger:!0});return toastr.success(I18n.t("entry_set.messages.entry_set_saved"))}}(this))};b.prototype.saveAndMoveToNextSection=function(a){this.entrySetResponse.set("entry_values",this.entrySetResponse.getEntryValuesForSection());a.trigger("form:submit");return this.listenToOnce(this.entrySetResponse,"updated",function(a){return function(){return a.sections.trigger("change:current:section",{model:a.sections.getNextSection()})}}(this))};b.prototype.getFormStepsView=function(a){return new d.FormSteps(g.extend(a))};
b.prototype.getFormView=function(){return new d.EntryFields({collection:this.entrySetResponse.get("entry_fields"),model:this.entrySetResponse})};b.prototype.getFormStepsRegion=function(){return this.getLayout().formStepsRegion};b.prototype.getFormWrapperRegion=function(){return this.getLayout().formWrapperRegion};b.prototype.buttonsConfig=function(){var a;a={formClass:"form-base form-horizontal",buttons:{primary:{text:I18n.t("actions.save_and_continue",{model:""})+" >>",className:"btn btn-info",buttonType:"saveAndContinue",
order:3},cancel:!1}};this.sections.isCurrentLast()&&(a.buttons.primary=g.extend(a.buttons.primary,{text:I18n.t("actions.save_and_complete",{model:""}),className:"btn btn-success",buttonType:"saveAndComplete",order:3}));this.sections.isCurrentFirst()||g.extend(a.buttons,{back:{text:"<< "+I18n.t("terms.go_back"),buttonType:"back",className:"btn btn-default",order:1}});return a};b.prototype.getLayout=function(a){return null!=this.layout?this.layout:this.layout=new d.Layout};b.prototype.sectionUrl=function(){return Routes.entry_set_response_section_path(this.entrySetResponse.id,
this.sections.getCurrentSection().id)};return b}(c.Controllers.Base)})}).call(this);
