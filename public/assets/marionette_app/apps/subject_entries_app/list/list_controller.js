(function(){var l={}.hasOwnProperty,m=function(d,c){function k(){this.constructor=d}for(var e in c)l.call(c,e)&&(d[e]=c[e]);k.prototype=c.prototype;d.prototype=new k;d.__super__=c.prototype;return d};this.Qapp.module("SubjectEntriesApp.List",function(d,c,k,e,l,n){return d.Controller=function(e){function b(){return b.__super__.constructor.apply(this,arguments)}m(b,e);b.prototype.initialize=function(a){this.person=c.request("get:person:entity",a.personId);c.execute("when:fetched",this.person,function(g){return function(){return c.execute("show:subject:navigation",
{person:g.person,personId:a.personId,currentItemName:"entries"})}}(this));return this.list(a)};b.prototype.list=function(a){var g,b;this.personId=a.personId;g=a.entrySetResponseId;b=a.sectionId;this.showLayout(this.items);this.items=c.request("get:person:entry:set:responder:items",a);return c.execute("when:fetched",this.items,function(a){return function(){var c;a.showEntrySetSelect(a.items);0!==a.items.size()&&(c=g?a.items.where({entry_set_response_id:g})[0]:a.items.first(),null!=c.get("completed")&&
a.getSections(c,b));return a.listenTo(a.getLayout(),"add:item:clicked",function(){return a.createItemSetup({collection:a.items})})}}(this))};b.prototype.getSections=function(a,b){var f,h;f={entrySetId:a.get("entry_set_response").get("entry_set_id"),entrySetResponse:a.get("entry_set_response"),currentSectionId:b};h=c.request("entry:set:sections:entities",f);return c.execute("when:fetched",h,function(a){return function(){a.showSections(h,h.getCurrentSection().id);return a.getEntries(h.getCurrentSection())}}(this))};
b.prototype.getEntries=function(a){var b;b=a.getSectionEntryResponses();b.comparator="display_order";return c.execute("when:fetched",b,function(a){return function(){return a.showEntryFields(b)}}(this))};b.prototype.showEntrySetSelect=function(a){a=new d.SelectItems({collection:a,layout:this.getLayout()});this.show(a,{region:this.getEntrySetSelectRegion(),loading:!1});return this.listenTo(a,"childview:select:response",function(a){return function(b){return a.getSections(b.model)}}(this))};b.prototype.showSections=
function(a,b){var f;f=new d.Sections({collection:a});this.listenTo(f,"childview:set:current:section",function(a){return function(b){a.getEntries(b.model);return c.navigate(a.entriesUrl(b.model),{replace:!1})}}(this));return this.show(f,{region:this.getSectionRegion(),loading:!1})};b.prototype.showEntryFields=function(a){var b;b=new d.Entries({collection:a});b.on("childview:show",function(b){return function(d){var e;e=b.layout.addRegion(d.entryValueRegionName(),"#"+d.entryValueRegionName());return c.execute("show:entry:values",
{region:e,entryField:d.model,entries:a})}}(this));return this.show(b,{loading:!0,region:this.getEntrySetValuesRegion()})};b.prototype.createItemSetup=function(a){null==a&&(a={});return c.request("create:responder:item:view",a)};b.prototype.getEntrySetValuesRegion=function(){return this.getLayout().entrySetValuesRegion};b.prototype.getEntrySetSelectRegion=function(){return this.getLayout().entrySetSelectRegion};b.prototype.getSectionRegion=function(){return this.getLayout().entrySetSectionsRegion};
b.prototype.showLayout=function(a){return c.request("default:region").show(this.getLayout())};b.prototype.getLayout=function(){return null!=this.layout?this.layout:this.layout=new d.Layout};b.prototype.entriesUrl=function(a){return n(""+Routes.person_path(this.personId)+"/entries/"+a.get("entrySetResponseId")+"/section/"+a.id).ltrim("/")};return b}(c.Controllers.Base)})}).call(this);
