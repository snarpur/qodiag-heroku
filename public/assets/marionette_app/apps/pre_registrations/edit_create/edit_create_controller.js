(function(){var k=function(d,c){return function(){return d.apply(c,arguments)}},h={}.hasOwnProperty,l=function(d,c){function g(){this.constructor=d}for(var e in c)h.call(c,e)&&(d[e]=c[e]);g.prototype=c.prototype;d.prototype=new g;d.__super__=c.prototype;return d};this.Qapp.module("PreRegistrationsApp.EditCreate",function(d,c,g,e,h,f){return d.Controller=function(e){function b(){this.getFieldsView=k(this.getFieldsView,this);return b.__super__.constructor.apply(this,arguments)}l(b,e);b.prototype.initialize=
function(){c.contentRegion.show(this.getLayout());return this.curentUser=c.request("get:current:user")};b.prototype.edit=function(a){var b;null==a&&(a={});this.step=a.step;this.id=a.id;b=c.request("get:responder:item:pre:registration",{id:this.id,step_no:this.step});return c.execute("when:fetched",b,function(a){return function(){a.type=b.get("registration_identifier").split("_")[0];a.subtype=b.get("subtype");a.steps=c.request("set:pre_registration:steps",{type:a.type,subtype:a.subtype});a.rootModel=
new c.Entities.FormPreRegistrationModel(b.attributes);return a.showFormSteps()}}(this))};b.prototype.showFormSteps=function(){var a;a=this.getFormStepsView(this.steps);null!=this.step&&(c.navigate(this.preRegistrationUrl(this.step),{replace:!0}),this.steps.setCurrentStep(this.step));this.getLayout().formStepsRegion.show(a);return this.showForm()};b.prototype.showForm=function(){var a;a=this.getFormConfig();this.controllerModel=new c.Entities.Model;this.fieldCollection=new c.Entities.FieldCollection(a,
{rootModel:this.rootModel,controllerModel:this.controllerModel});a=this.getFieldsView(this.fieldCollection);this.formView=c.request("form:wrapper",a,this.buttonsConfig());this.listenTo(this.formView,"form:back",function(a){return function(){return a.moveToPreviousStep()}}(this));this.listenTo(this.formView,"form:saveAndContinue form:save",function(a){return function(){return a.formView.trigger("form:submit",{collection:!1})}}(this));this.listenTo(this.formView,"before:form:submit",function(a){return function(){return a.saveFormData()}}(this));
return this.getLayout().mainRegion.show(this.formView)};b.prototype.saveFormData=function(){return this.listenToOnce(this.rootModel,"created updated",function(a){return function(b){toastr.success(I18n.t("activerecord.sucess.messages.saved",{model:""}));if(a.steps.isCurrentLast())return c.navigate("items",{trigger:!0});a.step=a.steps.getNextStep();return a.changeStep()}}(this))};b.prototype.changeStep=function(){var a;this.steps.setCurrentStep(this.step);this.steps.trigger("change:current:step");a=
c.request("get:responder:item:pre:registration",{id:this.id,step_no:this.step});return c.execute("when:fetched",a,function(b){return function(){b.rootModel=new c.Entities.FormPreRegistrationModel(a.attributes);c.navigate(b.preRegistrationUrl(b.step),{replace:!0});return b.showForm()}}(this))};b.prototype.moveToPreviousStep=function(){this.step=this.steps.getPreviousStep();return this.changeStep()};b.prototype.buttonsConfig=function(){var a;a={formClass:"form-base form-horizontal",errors:!1,buttons:{primary:!1,
save:!1,cancel:!1}};"subject"===this.type?f.extend(a.buttons,{primary:!1},{primary:{text:I18n.t("actions.save_and_complete"),buttonType:"save",order:2},back:!1}):(this.steps.isCurrentFirst()||f.extend(a.buttons,{back:{text:"<< "+I18n.t("terms.go_back"),buttonType:"back",className:"btn",order:1}}),this.steps.isCurrentLast()?f.extend(a.buttons,{primary:{text:I18n.t("actions.save_and_complete"),buttonType:"save",order:2}}):f.extend(a.buttons,{primary:!1},{primary:{text:I18n.t("actions.save_and_continue",
{model:""})+" >>",buttonType:"saveAndContinue",order:3}}));return a};b.prototype.getFieldsView=function(a){return new c.Components.Form.FieldCollectionView({collection:a,model:this.rootModel})};b.prototype.getFormConfig=function(){return null!=this.subtype?d.FormConfig[this.type][this.subtype]["step_"+this.step]:d.FormConfig[this.type]["step_"+this.step]};b.prototype.preRegistrationUrl=function(a){return"pre_registrations/"+this.id+"/step/"+a};b.prototype.getFormStepsView=function(a){return new d.FormSteps({collection:a})};
b.prototype.getFormStepsRegion=function(){return this.getLayout().formStepsRegion};b.prototype.getLayout=function(){return null!=this.layout?this.layout:this.layout=new d.Layout};return b}(c.Controllers.Base)})}).call(this);
