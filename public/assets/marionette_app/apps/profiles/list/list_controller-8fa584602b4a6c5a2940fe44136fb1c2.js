(function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};this.Qapp.module("ProfilesApp.List",function(List,App,Backbone,Marionette,$,_){var _ref;return List.Controller=(function(_super){__extends(Controller,_super);function Controller(){this.getLayout=__bind(this.getLayout,this);_ref=Controller.__super__.constructor.apply(this,arguments);return _ref}Controller.prototype.showProfile=function(subjectId){var _this=this;this.person=App.request("get:person:entity",subjectId);App.execute("when:fetched",this.person,function(){App.execute("show:subject:navigation",{person:_this.person,personId:subjectId,currentItemName:"profiles"});_this.showSubject(_this.person);return _this.showGuardian(_this.person)});return App.contentRegion.show(this.getLayout())};Controller.prototype.showSubject=function(person){var subjectView,_this=this;subjectView=this.getSubjectView(person);this.getLayout().subjectProfileRegion.show(subjectView);return this.listenTo(subjectView,"edit:subject:clicked",function(childSubjectView){return App.execute("edit:guardian",{model:childSubjectView.model,activeView:subjectView})})};Controller.prototype.showGuardian=function(person){var parents,_this=this;parents=person.getParents();return App.execute("when:fetched",parents,function(){var guardianView;_this.addEmptyParent(parents);parents=new App.Entities.People(parents.toJSON({acceptsNested:false}));guardianView=_this.getGuardianView(parents);_this.getLayout().guardianProfileRegion.show(guardianView);_this.listenTo(guardianView,"childview:edit:guardian:clicked",function(childGuardianView){return App.execute("edit:guardian",{model:childGuardianView.model,activeView:guardianView})});return _this.listenTo(guardianView,"childview:create:guardian:clicked",function(childGuardianView){return App.execute("create:guardian",{model:childGuardianView.model,activeView:guardianView,subjectId:_this.person.id})})})};Controller.prototype.addEmptyParent=function(parents){var parent;if(parents.size()===0){parent=new App.Entities.Person();parent.set({address:{}});parents.add(parent,{at:0})}if(parents.size()===1){parent=parents.first().clone().clear();parent.set({address:{}});return parents.add(parent,{at:1})}};Controller.prototype.getSubjectView=function(person){return new List.Subject({model:person})};Controller.prototype.getGuardianView=function(parents){return new List.Guardians({collection:parents})};Controller.prototype.getLayout=function(){var _ref1;return(_ref1=this.layout)!=null?_ref1:this.layout=new List.Layout};return Controller})(App.Controllers.Base)})}).call(this);