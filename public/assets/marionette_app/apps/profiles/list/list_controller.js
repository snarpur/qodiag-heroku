(function(){var k=function(d,c){return function(){return d.apply(c,arguments)}},h={}.hasOwnProperty,l=function(d,c){function g(){this.constructor=d}for(var f in c)h.call(c,f)&&(d[f]=c[f]);g.prototype=c.prototype;d.prototype=new g;d.__super__=c.prototype;return d};this.Qapp.module("ProfilesApp.List",function(d,c,g,f,h,m){return d.Controller=function(f){function e(){this.getLayout=k(this.getLayout,this);return e.__super__.constructor.apply(this,arguments)}l(e,f);e.prototype.showProfile=function(a){this.person=
c.request("get:person:entity",a);c.execute("when:fetched",this.person,function(b){return function(){b.profile=new c.Entities.FormPersonModel(b.person.attributes);c.execute("show:subject:navigation",{person:b.profile,personId:a,currentItemName:"profiles"});if(18<=b.profile.get("age"))return b.showAdultSubject(b.profile);b.showSubject(b.profile);if(!(18<=b.profile.get("age")))return b.showGuardians(b.profile)}}(this));return c.contentRegion.show(this.getLayout())};e.prototype.showSubject=function(a){var b;
b=this.getSubjectView(a);this.getLayout().subjectProfileRegion.show(b);return this.listenTo(b,"edit:subject:clicked",function(a){return function(a){return c.execute("edit:guardian",{model:a.model,activeView:b})}}(this))};e.prototype.showAdultSubject=function(a){var b;b=this.getAdultSubjectView(a);this.getLayout().subjectProfileRegion.show(b);return this.listenTo(b,"edit:guardian:clicked",function(a){return function(a){return c.execute("edit:guardian",{model:a.model,activeView:b})}}(this))};e.prototype.showGuardian=
function(a){var b;b=this.getSubjectView(a);this.getLayout().subjectProfileRegion.show(b);return this.listenTo(b,"edit:subject:clicked",function(a){return function(a){return c.execute("edit:guardian",{model:a.model,activeView:b})}}(this))};e.prototype.showGuardians=function(a){var b;b=a.getParents();return c.execute("when:fetched",b,function(a){return function(){var d;a.addEmptyParent(b);b=new c.Entities.FormPeopleCollection(b.toJSON({acceptsNested:!1}));d=a.getGuardiansView(b);a.getLayout().guardianProfileRegion.show(d);
a.listenTo(d,"childview:edit:guardian:clicked",function(a){return c.execute("edit:guardian",{model:a.model,activeView:d})});return a.listenTo(d,"childview:create:guardian:clicked",function(b){return c.execute("create:guardian",{model:b.model,activeView:d,subjectId:a.profile.id})})}}(this))};e.prototype.addEmptyParent=function(a){var b;0===a.size()&&(b=new c.Entities.FormPersonModel,b.set({address:{}}),a.add(b,{at:0}));if(1===a.size())return b=a.first().clone().clear(),b.set({address:{}}),a.add(b,
{at:1})};e.prototype.getSubjectView=function(a){return new d.Subject({model:a,name:"Subject"})};e.prototype.getAdultSubjectView=function(a){return new d.AdultSubject({model:a,name:"Subject"})};e.prototype.getGuardiansView=function(a){return new d.Guardians({collection:a,name:"Guardian"})};e.prototype.getGuardianView=function(a){return new d.Guardian({model:a,name:"Guardian"})};e.prototype.getLayout=function(){return null!=this.layout?this.layout:this.layout=new d.Layout};return e}(c.Controllers.Base)})}).call(this);
