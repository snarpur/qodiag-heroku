(function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};this.Qapp.module("ResponderItemsApp.Create",function(Create,App,Backbone,Marionette,$,_){var _ref;return Create.Controller=(function(_super){__extends(Controller,_super);function Controller(){_ref=Controller.__super__.constructor.apply(this,arguments);return _ref}Controller.prototype.initialize=function(options){this.collection=options.collection;return this.entrySets=App.request("entry:sets:entities")};Controller.prototype.create=function(){return this.showResponderItem()};Controller.prototype.showResponderItem=function(){var r,respJSON,respondents,_this=this;respJSON=this.getSubject().get("respondents").toJSON({acceptsNested:false});respondents=(function(){var _i,_len,_results;_results=[];for(_i=0,_len=respJSON.length;_i<_len;_i++){r=respJSON[_i];_results.push(_.pick(r,"id","full_name"))}return _results})();return App.execute("when:fetched",this.entrySets,function(){var e,entrySets,entrySetsJSON,formView,view;entrySetsJSON=_this.entrySets.toJSON({acceptsNested:false});entrySets=(function(){var _i,_len,_results;_results=[];for(_i=0,_len=entrySetsJSON.length;_i<_len;_i++){e=entrySetsJSON[_i];_results.push(_.pick(e,"id","name"))}return _results})();view=new Create.ResponderItem({model:_this.getItem(),respondents:respondents,entrySets:entrySets});formView=App.request("form:wrapper",view,_this.buttonsConfig());return App.dialogRegion.show(formView)})};Controller.prototype.getItem=function(){var _ref1,_this=this;if((_ref1=this.item)==null){this.item=new App.Entities.ResponderItem({caretaker_id:App.request("get:current:user").get("person_id"),subject_id:this.getSubject().id})}this.listenTo(this.item,"created",function(){return _this.collection.add(_this.item)});return this.item};Controller.prototype.getSubject=function(){return App.request("get:current:subject")};Controller.prototype.buttonsConfig=function(){var options;options={modal:true,title:"Senda nýja beiðni",formClass:"form-horizontal"};return options};return Controller})(App.Controllers.Base)})}).call(this);