(function(){var e=function(d,b){return function(){return d.apply(b,arguments)}},g={}.hasOwnProperty,h=function(d,b){function e(){this.constructor=d}for(var f in b)g.call(b,f)&&(d[f]=b[f]);e.prototype=b.prototype;d.prototype=new e;d.__super__=b.prototype;return d};this.Qapp.module("ResponderItemsApp.Create",function(d,b,g,f,k,l){return d.Controller=function(f){function c(){this.getSurveyItem=e(this.getSurveyItem,this);this.getEntrySetItem=e(this.getEntrySetItem,this);this.getFieldsView=e(this.getFieldsView,
this);return c.__super__.constructor.apply(this,arguments)}h(c,f);c.prototype.initialize=function(a){this.collection=a.collection;this.itemCollection=a.itemCollection;this.respondents=this.getSubject().get("respondents");return this.controllerModel=new b.Entities.Model};c.prototype.create=function(){this.entrySets=b.request("entry:sets:entities");return this.showResponderItem()};c.prototype.createSurvey=function(){this.surveys=b.request("get:surveys");return this.showSurveyResponderItem()};c.prototype.showSurveyResponderItem=
function(){return b.execute("when:fetched",this.surveys,function(a){return function(){var c,d;c=a.getSurveyFormConfig();a.rootModel=a.getSurveyItem();a.rootModel.set("_survey_id_options",a.surveys);a.rootModel.set("_respondent_id_options",a.respondents);a.fieldCollection=new b.Entities.FieldCollection(c,{rootModel:a.rootModel,controllerModel:a.controllerModel});d=a.getFieldsView(a.fieldCollection);c=b.request("form:wrapper",d,a.buttonsConfig());b.dialogRegion.show(c);a.listenTo(c,"before:form:submit",
function(){return a.listenTo(a.rootModel,"created",function(b){return a.itemCollection.add(b.clone())})});return d}}(this))};c.prototype.showResponderItem=function(){return b.execute("when:fetched",this.entrySets,function(a){return function(){var c;c=a.getEntrySetFormConfig();a.rootModel=a.getEntrySetItem();a.rootModel.get("entry_set_response").set("_entry_set_id_options",a.entrySets);a.listenTo(a.rootModel,"change:entry_set_response.entry_set_id",function(b,c,d){if(null!=d.modelSelected)return a.rootModel.get("entry_set_response").set("name",
d.modelSelected.get("name"))});a.fieldCollection=new b.Entities.FieldCollection(c,{rootModel:a.rootModel,controllerModel:a.controllerModel});a.listenTo(a.rootModel,"created",function(b){return a.collection.add(b)});c=a.getFieldsView(a.fieldCollection);c=b.request("form:wrapper",c,a.buttonsConfig());b.dialogRegion.show(c);return a.rootModel.set("_respondent_id_options",a.respondents)}}(this))};c.prototype.getEntrySetFormConfig=function(){return d.EntrySet.FormConfig};c.prototype.getSurveyFormConfig=
function(){return d.Survey.FormConfig};c.prototype.getFieldsView=function(a){return new b.Components.Form.FieldCollectionView({collection:a,model:this.rootModel})};c.prototype.getEntrySetItem=function(){null==this.item&&(this.item=new b.Entities.FormResponderItemModel({caretaker_id:b.request("get:current:user").get("person_id"),subject_id:this.getSubject().id,entry_set_response:{entry_set_id:null}}));return this.item};c.prototype.getSurveyItem=function(){null==this.item&&(this.item=new b.Entities.FormResponderItemModel({caretaker_id:b.request("get:current:user").get("person_id"),
subject_id:this.getSubject().id,item_type:"survey",response_set:{id:null},survey_id:null}));return this.item};c.prototype.getSubject=function(){return b.request("get:current:subject")};c.prototype.buttonsConfig=function(){return{errors:!1,modal:!0,title:I18n.t("views.responder_items.requests.submit"),formClass:"form-horizontal"}};return c}(b.Controllers.Base)})}).call(this);
