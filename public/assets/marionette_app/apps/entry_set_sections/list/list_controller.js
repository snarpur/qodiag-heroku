(function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};this.Qapp.module("EntrySetSectionsApp.List",function(List,App,Backbone,Marionette,$,_){var _ref;return List.Controller=(function(_super){__extends(Controller,_super);function Controller(){_ref=Controller.__super__.constructor.apply(this,arguments);return _ref}Controller.prototype.list=function(options){return this.getEntrySet(options)};Controller.prototype.showSidebarOnce=function(){var _this=this;return this.getEntryFieldsRegion().on("show",function(region){return _this.executeSidebar({droppableCollection:region.model.collection,droppableElement:region.$itemViewContainer})})};Controller.prototype.getEntrySet=function(options){var entrySet,_this=this;entrySet=App.request("entry:set:entity",{id:options.entrySetId});return App.execute("when:fetched",entrySet,function(){App.contentRegion.show(_this.getLayout(entrySet));window.sectionregion=_this.getSectionContentRegion();_this.showSidebarOnce();_this.showEntrySetTitle(entrySet);_this.executeSettingsNavigation(entrySet);return _this.getSections(_.extend(options,{entrySet:entrySet}))})};Controller.prototype.getSections=function(options){var sections,_this=this;sections=App.request("entry:set:sections:entities",options);return App.execute("when:fetched",sections,function(){var section;section=sections.getCurrentSection();_this.showSectionsNavigation(sections,options.entrySet);if(sections.length!==0){return _this.executeFields({model:sections.getCurrentSection()})}else{}})};Controller.prototype.executeFields=function(options){App.execute("show:settings:section:fields",_.extend(options,{region:this.getSectionContentRegion(),loaderRegion:this.getEntryFieldsRegion()}));return this.showTitle(options.model)};Controller.prototype.executeSidebar=function(options){return App.execute("show:settings:sidebar:fields",_.extend(options,{region:this.getSidebarRegion()}))};Controller.prototype.showSectionsNavigation=function(sections,entrySet){var view,_this=this;view=this.getNavigationView(sections);this.show(view,{region:this.getNavigationRegion(),loading:false});this.listenTo(sections,"change:current:section",function(options){_this.executeFields(options);return App.navigate(_this.sectionUrl(options.model),{replace:true})});return this.listenTo(view,"add:new:section:clicked",function(view){return App.execute("create:section",{entrySet:entrySet,section:view.collection.newSection(),collection:view.collection,activeView:_this.getLayout()})})};Controller.prototype.showTitle=function(section){var view,_this=this;view=new List.Title({model:section});this.show(view,{region:this.getLayout().sectionTitleRegion,loading:{loadingType:"opacity"}});return this.listenTo(view,"edit:title",function(options){return App.execute("edit:section",{section:options.model,activeView:_this.getLayout()})})};Controller.prototype.showEntrySetTitle=function(entrySet){var view,_this=this;view=new List.Title({model:entrySet});this.show(view,{region:this.getLayout().entrySetTitleRegion,loading:false});this.listenTo(view,"edit:title",function(options){return App.execute("edit:section",{section:entrySet,activeView:_this.getLayout()})});return this.listenTo(view,"remove:title",function(options){return App.execute("remove:entry_set",{model:entrySet})})};Controller.prototype.executeSettingsNavigation=function(entrySet){return App.execute("show:settings:navigation",{currentSetting:"entry_sets",subView:entrySet.get("name"),region:this.getLayout().settingsNavigationRegion})};Controller.prototype.getNavigationView=function(collection){return new List.SectionsNav({collection:collection,model:collection.getCurrentSection()})};Controller.prototype.getNavigationRegion=function(){return this.getLayout().navigationRegion};Controller.prototype.getSectionContentRegion=function(){return this.getLayout().sectionContentRegion};Controller.prototype.getSidebarRegion=function(){return this.getLayout().entryFieldsSidebarRegion};Controller.prototype.getEntryFieldsRegion=function(){return this.getLayout().entryFieldsRegion};Controller.prototype.getLayout=function(entrySet){var _ref1;return(_ref1=this.layout)!=null?_ref1:this.layout=new List.Layout({model:entrySet})};Controller.prototype.sectionUrl=function(section){var params;params=_.values(section.pick("entry_set_id","id"));return"settings"+(Routes.entry_set_section_path.apply(Routes,params))};return Controller})(App.Controllers.Base)})}).call(this);