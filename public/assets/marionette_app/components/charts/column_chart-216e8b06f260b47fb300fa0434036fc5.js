(function(){var g=function(b,c){return function(){return b.apply(c,arguments)}},h={}.hasOwnProperty,k=function(b,c){function e(){this.constructor=b}for(var f in c)h.call(c,f)&&(b[f]=c[f]);e.prototype=c.prototype;b.prototype=new e;b.__super__=c.prototype;return b};this.Qapp.module("Components.Charts",function(b,c,e,f,h,d){var l;b.Column=function(b){function a(){this.addChartToHistory=g(this.addChartToHistory,this);this.back=g(this.back,this);return a.__super__.constructor.apply(this,arguments)}k(a,
b);a.prototype.urlRoot="/responder_items/responses";a.prototype.chartOptionKeys="chart series accessCode credits legend subtitle drilldown title tooltip yAxis xAxis plotOptions".split(" ");a.prototype.initialize=function(){this.set("chartOptions",this.pick(this.chartOptionKeys));this.initHistory();this.url=function(){return""+this.urlRoot+"/"+this.get("id")+"/column"};return a.__super__.initialize.apply(this,arguments)};a.prototype.initHistory=function(){var a;a={xAxis:{categories:d.clone(this.get("chartOptions").xAxis.categories)},
series:d.clone(this.get("chartOptions").series)};return this.set("drilldownHistory",[a],{silent:!0})};a.prototype.chartWidth=function(){return this.get("size")/this.collection.totalSize()};a.prototype.back=function(a){var b;if(!this.isChartRoot())return this.get("drilldownHistory").pop(),b=d.last(this.get("drilldownHistory")),a=this.get("chartOptions"),a.xAxis.categories=b.xAxis.categories,a.series=b.series,this.trigger("change:drilldownHistory",{config:a,type:"drillup"})};a.prototype.currentDrilldownLevel=
function(){return this.get("drilldownHistory").length};a.prototype.isChartRoot=function(){return 1===this.get("drilldownHistory").length};a.prototype.addChartToHistory=function(a){var b;this.get("drilldownHistory").push(a);b=this.get("chartOptions");b.xAxis.categories=a.xAxis.categories;b.series=a.series;return this.trigger("change:drilldownHistory",{config:b,type:"drilldown"})};return a}(e.Model);b.Columns=function(c){function a(){return a.__super__.constructor.apply(this,arguments)}k(a,c);a.prototype.model=
b.Column;a.prototype.initialize=function(a,b){this.options=b;this.setCurrentMetric(b.currentMetric);return this.url=function(){var a;a="/responder_items/responses/:id/column".replace(/\:id/,this.responderItemId());d.isEmpty(this.currentMetric)?d.isEmpty(this.normReferenceId)||(a=""+a+"/norm_reference/"+this.normReferenceId):a=d.isEmpty(this.normReferenceId)?""+a+"/"+this.currentMetric:""+a+"/norm_reference/"+this.normReferenceId+"/"+this.currentMetric;return a}};a.prototype.parse=function(a){d.extend(this.options,
d.omit(a,"charts"));return a.charts};a.prototype.totalSize=function(){return d.reduce(this.pluck("size"),function(a,b){return a+b},0)};a.prototype.getChartMenu=function(){return this.chartMenu?this.chartMenu:this.chartMenu=new e.Collection(this.options.chartMetrics)};a.prototype.getChartFilter=function(){return this.chartFilters?this.chartFilters:this.chartFilters=new e.Collection(this.options.chartFilters)};a.prototype.responderItemId=function(){return this.options.responderItem.get("id")};a.prototype.responderItem=
function(){return this.options.responderItem};a.prototype.setCurrentMetric=function(a){return this.currentMetric=a};a.prototype.setNormReferenceId=function(a){return this.normReferenceId=a};return a}(e.Collection);l={getCharts:function(c){return function(a){a=new b.Columns([],{responderItem:a.item});a.fetch({reset:!0});return a}}(this)};return c.reqres.setHandler("column:charts",function(b){return l.getCharts(b)})})}).call(this);
