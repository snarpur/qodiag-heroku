(function(){var l={}.hasOwnProperty,c=function(b,c){function d(){this.constructor=b}for(var g in c)l.call(c,g)&&(b[g]=c[g]);d.prototype=c.prototype;b.prototype=new d;b.__super__=c.prototype;return b},d=function(b,c){return function(){return b.apply(c,arguments)}};this.Qapp.module("Components.Form",function(b,k,l,g,m,e){b.FormWrapper=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}c(a,b);a.prototype.getTemplate=function(){return this.options.config.modal?"form/modal-form":
"form/form"};a.prototype.tagName="form";a.prototype.className=function(){return this.options.config.formClass};a.prototype.attributes=function(){return{"data-type":this.getFormDataType()}};a.prototype.regions={formContentRegion:"#form-content-region"};a.prototype.ui={buttonContainer:"ul.inline-list"};a.prototype.events={"click button[data-form-button]":"formButtonClick","click button[data-dismiss]":"closeButtonClick",keyup:"keypressed"};a.prototype.formButtonClick=function(a){a=m(a.target).attr("data-form-button");
return this.trigger("form:"+a,{sourceButton:a})};a.prototype.keypressed=function(a){if(13===a.which&&"textarea"!==a.target.type)return this.trigger("form:submit",{collection:!1})};a.prototype.closeButtonClick=function(){return this.trigger("form:cancel")};a.prototype.modelEvents={"sync:start":"syncStart","sync:stop":"syncStop"};a.prototype.initialize=function(a){this.addOpacityWrapper(!1);return this.setInstancePropertiesFor("config","buttons")};a.prototype.setFormContentRegion=function(a){return this.region.formContentRegion=
a};a.prototype.serializeData=function(){var a,h;return{footer:this.config.footer,modal:this.config.modal,title:this.config.title||!1,buttons:null!=(a=null!=(h=this.buttons)?h.toJSON():void 0)?a:!1}};a.prototype.onShow=function(){return e.defer(function(a){return function(){a.config.focusFirstInput&&a.focusFirstInput();if(a.buttons)return a.buttonPlacement()}}(this))};a.prototype.buttonPlacement=function(){return this.ui.buttonContainer.addClass(this.buttons.placement)};a.prototype.focusFirstInput=
function(){return this.$el.find("input[type=text],textarea,select").filter(":visible:enabled:first").focus()};a.prototype.getFormDataType=function(){return this.model.isNew()?"new":"edit"};a.prototype.syncStart=function(a){if(this.config.syncing)return this.addOpacityWrapper()};a.prototype.syncStop=function(a){if(this.config.syncing)return this.addOpacityWrapper(!1)};return a}(k.Views.Layout);b.FieldView=function(b){function a(){this.optionsChanged=d(this.optionsChanged,this);this.templateHelpers=
d(this.templateHelpers,this);return a.__super__.constructor.apply(this,arguments)}c(a,b);a.prototype.initialize=function(n){this.modelIsNew=n["new"];return a.__super__.initialize.apply(this,arguments)};a.prototype.getTemplate=function(){return"form/templates/_"+this.model.get("fieldType")+"_field"};a.prototype.onRender=function(){if(null!=this.model.get("_errors"))return this.changeErrors(this.model,this.model.get("_errors"))};a.prototype.getLabel=function(a){null==a&&(a=null);if(null!=a&&null!=this.model.get("labelKey"))return e.has(this.model.get("labelKey"),
"i18nBase")?I18n.t(this.model.get("labelKey").i18nBase+"."+a.get(""+this.model.get("labelKey").key)):a.get(""+this.model.get("labelKey").key);a=null!=(null!=a?a.get("label"):void 0)?a.get("label"):this.model.get("fieldLabel");return e.has(a,"i18n")?I18n.t(a.i18n):a};a.prototype.getValue=function(a){null==a&&(a=null);return null!=a?null!=this.model.get("valueKey")?a.get(""+this.model.get("valueKey")):a.get("value"):null!=this.model.get("valueKey")?this.model.get("valueKey"):"value"};a.prototype.templateHelpers=
function(){return{isDisabled:function(a){return function(){if(!a.modelIsNew&&a.model.get("disabled"))return"disabled='disabled'"}}(this),label:function(a){return function(){return a.getLabel()}}(this),value:function(a){return function(){return a.getValue()}}(this)}};a.prototype.modelEvents={"change:_errors":"changeErrors","change:options":"optionsChanged"};a.prototype.optionsChanged=function(){};a.prototype.changeErrors=function(a,h,b){this.removeErrors();return this.addErrors(h)};a.prototype.removeErrors=
function(){this.$el.removeClass("has-error");return this.$el.find(".help-block").text("")};a.prototype.addErrors=function(a){var b,f,c;null==a&&(a={});c=[];for(f in a)b=a[f],c.push(this.addError(f,b));return c};a.prototype.addError=function(a,b){var f;f=this.$el.find("[id='"+a+"_error']");f.closest(".form-group").addClass("has-error");return f.text(b)};a.prototype.onShow=function(){this.bindings={};this.bindings["#"+this.model.get("fieldName")]="fieldValue";return this.stickit()};return a}(k.Views.ItemView);
b.TextFieldView=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}c(a,b);a.prototype.className="form-group";return a}(b.FieldView);b.HiddenFieldView=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}c(a,b);return a}(b.FieldView);b.TextAreaFieldView=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}c(a,b);a.prototype.className="form-group";return a}(b.FieldView);b.SelectFieldView=function(b){function a(){this.templateHelpers=
d(this.templateHelpers,this);this.optionsChanged=d(this.optionsChanged,this);return a.__super__.constructor.apply(this,arguments)}c(a,b);a.prototype.className="form-group";a.prototype.optionsChanged=function(){this.render();return this.stickit()};a.prototype.templateHelpers=function(){var b;b=a.__super__.templateHelpers.apply(this,arguments);return e.extend(b,{selectOptions:function(a){return function(){return a.model.get("options").models}}(this),label:function(a){return function(b){return a.getLabel(b)}}(this),
value:function(a){return function(b){return a.getValue(b)}}(this)})};return a}(b.FieldView);b.TitleFieldView=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}c(a,b);return a}(b.FieldView);b.SeparatorFieldView=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}c(a,b);a.prototype.className="col-lg-12";a.prototype.ui={body:".panel-body"};return a}(b.FieldView);b.CheckBoxFieldView=function(b){function a(){this.templateHelpers=d(this.templateHelpers,
this);this.checkboxChange=d(this.checkboxChange,this);this.getOptions=d(this.getOptions,this);return a.__super__.constructor.apply(this,arguments)}c(a,b);a.prototype.className="form-group";a.prototype.events={"change input[type='checkbox']":"checkboxChange"};a.prototype.getOptions=function(){return null!=this.model.get("conditions")?this.model.get("options").where(this.model.get("conditions")):this.model.get("options").models};a.prototype.getValue=function(a){null==a&&(a=null);if(null!=this.model.get("labelKey"))return a.get(""+
this.model.get("labelKey").key);a=null!=(null!=a?a.get("label"):void 0)?a.get("label"):this.model.get("fieldLabel");return e.has(a,"i18n")?I18n.t(a.i18n):a};a.prototype.checkboxChange=function(a){var b,c;b=null!=this.model.get("labelKey")?this.model.get("labelKey").key:"label";c={};c[b]=a.currentTarget.value;b=this.model.get("options").findWhere(c);if(null!=b)return b.set("_destroy",!a.currentTarget.checked),b.set("_status",a.currentTarget.checked)};a.prototype.templateHelpers=function(){var b;b=
a.__super__.templateHelpers.apply(this,arguments);return e.extend(b,{checkBoxOptions:function(a){return function(){return a.getOptions()}}(this),isChecked:function(a){return function(a){if(null!=a.get("_status")&&a.get("_status"))return"checked='checked'"}}(this),label:function(a){return function(b){return a.getLabel(b)}}(this),value:function(a){return function(b){return a.getValue(b)}}(this)})};return a}(b.FieldView);b.RadioFieldView=function(b){function a(){return a.__super__.constructor.apply(this,
arguments)}c(a,b);a.prototype.className="form-group";a.prototype.onShow=function(){this.bindings={};this.bindings["."+this.model.get("fieldName")]="fieldValue";return this.stickit()};return a}(b.SelectFieldView);b.DateFieldView=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}c(a,b);a.prototype.className="form-group";a.prototype.ui=function(){return{datepick:"#"+this.model.get("fieldName")}};a.prototype.onShow=function(){var a;this.setBindings();if("date"===this.model.get("fieldType"))return a=
{language:I18n.locale,autoclose:!0,forceParse:!1,format:"dd/mm/yy",startDate:(new Date).addDays(1),todayHighlight:!0},this.ui.datepick.datepicker(a)};a.prototype.setBindings=function(){this.bindings={};this.bindings["#"+this.model.get("fieldName")]={observe:"fieldValue",onGet:function(a,b){if(null==a)return moment(a,"YYYY-MM-DDTHH:mmZ").format("DD/MM/YY")},onSet:function(a,b){return moment(a,"DD/MM/YY").format("YY/MM/DD")}};return this.stickit()};return a}(b.FieldView);return b.FieldCollectionView=
function(d){function a(){return a.__super__.constructor.apply(this,arguments)}c(a,d);a.prototype.getItemView=function(a){return null!=a?null==a.get("fieldClass")?(a=""+e.camelize(e.capitalize(a.get("fieldType")))+"FieldView",b[a]):a.get("fieldClass"):b.TextFieldView};a.prototype.itemViewOptions=function(){return{"new":this.model.isNew()}};a.prototype.appendHtml=function(a,b,c){c=b.model.get("fieldType");"separator"===c&&(this.lastSeparator=m(b.ui.body));return"separator"!==c&&this.lastSeparator?this.lastSeparator.append(b.el):
a.$el.append(b.el)};return a}(k.Views.CollectionView)})}).call(this);
