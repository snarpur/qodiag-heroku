(function(){var h={}.hasOwnProperty,k=function(d,c){function g(){this.constructor=d}for(var e in c)h.call(c,e)&&(d[e]=c[e]);g.prototype=c.prototype;d.prototype=new g;d.__super__=c.prototype;return d};this.Qapp.module("Components.Form",function(d,c,g,e,h,f){d.Controller=function(e){function b(){return b.__super__.constructor.apply(this,arguments)}k(b,e);b.prototype.initialize=function(a){var b,c;null==a&&(a={});this.contentView=a.view;this.modal=a.config.modal;this.collection=null!=(b=a.config.collection)?
b:!1;this.formLayout=this.getFormLayout(a.config);this.listenTo(this.formLayout,"show",this.formContentRegion);this.listenTo(this.formLayout,"form:submit",function(a){return function(b){return a.formSubmit(b)}}(this));this.listenTo(this.formLayout,"form:cancel",this.formCancel);if(this.modal)return a=f.values(this.contentView.bindings),this.previous=(c=this.contentView.model).pick.apply(c,a)};b.prototype.formCancel=function(){return this.modal?(this.contentView.model.set(this.previous),this.contentView.model.unset("_errors"),
c.dialogRegion.closeDialog()):this.contentView.triggerMethod("form:cancel")};b.prototype.formSubmit=function(a){var b;null==a&&(a={});this.contentView.triggerMethod("form:submit");a=this.contentView.model;b=this.getCollection(a);this.listenToOnce(a,"validated:invalid validated:valid",function(a){return function(c,d){a.stopListening(c,"validated:invalid validated:valid");if(f.isEmpty(c._errorsWithNested()))return a.formLayout.trigger("before:form:submit"),a.processFormSubmit(c,b)}}(this));return a.validateNested()};
b.prototype.getCollection=function(a){return null!=this.collection?this.collection:a instanceof this.contentView.collection.model?this.contentView.collection:!1};b.prototype.processFormSubmit=function(a,b){a.save(a.toJSON(),{collection:b});if(this.modal)return this.listenTo(a,"created updated",function(a){return function(){return c.dialogRegion.closeDialog()}}(this))};b.prototype.onClose=function(){};b.prototype.formContentRegion=function(){this.region=this.formLayout.formContentRegion;return this.show(this.contentView)};
b.prototype.getFormLayout=function(a){var b;null==a&&(a={});b=this.getDefaultConfig(f.result(this.contentView,"form"));f.extend(b,a);a=this.getButtons(b.buttons);return new d.FormWrapper({config:b,model:this.contentView.model,buttons:a,view:this.contentView})};b.prototype.getDefaultConfig=function(a){null==a&&(a={});return f.defaults(a,{footer:!0,focusFirstInput:!0,errors:!0,syncing:!1,modal:!1,formClass:""})};b.prototype.getButtons=function(a){null==a&&(a={});if(!1!==a)return c.request("form:button:entities",
a,this.contentView.model)};return b}(c.Controllers.Base);return c.reqres.setHandler("form:wrapper",function(c,b){null==b&&(b={});if(!c.model)throw Error(I18n.t("marionette.errors.model_not_found"));return(new d.Controller({view:c,config:b})).formLayout})})}).call(this);
