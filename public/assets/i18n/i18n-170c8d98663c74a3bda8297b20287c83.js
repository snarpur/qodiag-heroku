Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(void 0===this||null===this)throw new TypeError;var b=Object(this),d=b.length>>>0;if(0===d)return-1;var c=0;0<arguments.length&&(c=Number(arguments[1]),c!==c?c=0:0!==c&&(Infinity!==c&&-Infinity!==c)&&(c=(0<c||-1)*Math.floor(Math.abs(c))));if(c>=d)return-1;for(c=0<=c?c:Math.max(d-Math.abs(c),0);c<d;c++)if(c in b&&b[c]===a)return c;return-1});var I18n=I18n||{};I18n.defaultLocale="en";I18n.fallbacks=!1;I18n.defaultSeparator=".";
I18n.locale=null;I18n.PLACEHOLDER=/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm;I18n.fallbackRules={};I18n.pluralizationRules={en:function(a){return 0==a?["zero","none","other"]:1==a?"one":"other"}};I18n.getFallbacks=function(a){if(a===I18n.defaultLocale)return[];if(!I18n.fallbackRules[a]){for(var b=[],d=a.split("-"),c=1;c<d.length;c++)b.push(d.slice(0,c).join("-"));b.push(I18n.defaultLocale);I18n.fallbackRules[a]=b}return I18n.fallbackRules[a]};I18n.isValidNode=function(a,b,d){return null!==a[b]&&a[b]!==d};
I18n.lookup=function(a,b){b=b||{};var d=a,c=this.prepareOptions(I18n.translations),f=b.locale||I18n.currentLocale(),c=c[f]||{};b=this.prepareOptions(b);var h;"object"==typeof a&&(a=a.join(this.defaultSeparator));b.scope&&(a=b.scope.toString()+this.defaultSeparator+a);for(a=a.split(this.defaultSeparator);c&&0<a.length;)h=a.shift(),c=c[h];if(!c){if(I18n.fallbacks)for(f=this.getFallbacks(f);0<f.length&&!(c=I18n.lookup(d,this.prepareOptions({locale:f[0]},b)));f++);!c&&this.isValidNode(b,"defaultValue")&&
(c=b.defaultValue)}return c};I18n.prepareOptions=function(){for(var a={},b,d=arguments.length,c=0;c<d;c++)if(b=arguments[c])for(var f in b)this.isValidNode(a,f)||(a[f]=b[f]);return a};I18n.interpolate=function(a,b){b=this.prepareOptions(b);var d=a.match(this.PLACEHOLDER),c,f,h;if(!d)return a;for(var k=0;c=d[k];k++)h=c.replace(this.PLACEHOLDER,"$1"),f=b[h],this.isValidNode(b,h)||(f="[missing "+c+" value]"),regex=RegExp(c.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}")),a=a.replace(regex,f);return a};
I18n.translate=function(a,b){b=this.prepareOptions(b);var d=this.lookup(a,b);try{return"object"==typeof d?"number"==typeof b.count?this.pluralize(b.count,a,b):d:this.interpolate(d,b)}catch(c){return this.missingTranslation(a)}};I18n.localize=function(a,b){switch(a){case "currency":return this.toCurrency(b);case "number":return a=this.lookup("number.format"),this.toNumber(b,a);case "percentage":return this.toPercentage(b);default:return a.match(/^(date|time)/)?this.toTime(a,b):b.toString()}};
I18n.parseDate=function(a){var b;if("object"==typeof a)return a;if(b=a.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2}))?(Z|\+0000)?/)){for(a=1;6>=a;a++)b[a]=parseInt(b[a],10)||0;b[2]-=1;b=b[7]?new Date(Date.UTC(b[1],b[2],b[3],b[4],b[5],b[6])):new Date(b[1],b[2],b[3],b[4],b[5],b[6])}else"number"==typeof a?(b=new Date,b.setTime(a)):(a.match(/\d+ \d+:\d+:\d+ [+-]\d+ \d+/),b=new Date,b.setTime(Date.parse(a)));return b};
I18n.toTime=function(a,b){var d=this.parseDate(b),c=this.lookup(a);return d.toString().match(/invalid/i)||!c?d.toString():this.strftime(d,c)};
I18n.strftime=function(a,b){var d=this.lookup("date");if(!d)return a.toString();d.meridian=d.meridian||["AM","PM"];var c=a.getDay(),f=a.getDate(),h=a.getFullYear(),k=a.getMonth()+1,n=a.getHours(),l=n,r=11<n?1:0,p=a.getSeconds(),q=a.getMinutes(),m=a.getTimezoneOffset(),g=Math.floor(Math.abs(m/60)),e=Math.abs(m)-60*g,m=(0<m?"-":"+")+(2>g.toString().length?"0"+g:g)+(2>e.toString().length?"0"+e:e);12<l?l-=12:0===l&&(l=12);g=function(a){a="0"+a.toString();return a.substr(a.length-2)};e=b.replace("%a",
d.abbr_day_names[c]);e=e.replace("%A",d.day_names[c]);e=e.replace("%b",d.abbr_month_names[k]);e=e.replace("%B",d.month_names[k]);e=e.replace("%d",g(f));e=e.replace("%e",f);e=e.replace("%-d",f);e=e.replace("%H",g(n));e=e.replace("%-H",n);e=e.replace("%I",g(l));e=e.replace("%-I",l);e=e.replace("%m",g(k));e=e.replace("%-m",k);e=e.replace("%M",g(q));e=e.replace("%-M",q);e=e.replace("%p",d.meridian[r]);e=e.replace("%S",g(p));e=e.replace("%-S",p);e=e.replace("%w",c);e=e.replace("%y",g(h));e=e.replace("%-y",
g(h).replace(/^0+/,""));e=e.replace("%Y",h);return e=e.replace("%z",m)};
I18n.toNumber=function(a,b){b=this.prepareOptions(b,this.lookup("number.format"),{precision:3,separator:".",delimiter:",",strip_insignificant_zeros:!1});var d=0>a,c=Math.abs(a).toFixed(b.precision).toString().split("."),f=[];for(a=c[0];0<a.length;)f.unshift(a.substr(Math.max(0,a.length-3),3)),a=a.substr(0,a.length-3);f=f.join(b.delimiter);0<b.precision&&(f+=b.separator+c[1]);d&&(f="-"+f);b.strip_insignificant_zeros&&(d=RegExp(b.separator.replace(/\./,"\\.")+"$"),f=f.replace(/0+$/,"").replace(d,""));
return f};I18n.toCurrency=function(a,b){b=this.prepareOptions(b,this.lookup("number.currency.format"),this.lookup("number.format"),{unit:"$",precision:2,format:"%u%n",delimiter:",",separator:"."});a=this.toNumber(a,b);return a=b.format.replace("%u",b.unit).replace("%n",a)};
I18n.toHumanSize=function(a,b){for(var d=a,c=0,f;1024<=d&&4>c;)d/=1024,c+=1;0===c?(c=this.t("number.human.storage_units.units.byte",{count:d}),f=0):(c=this.t("number.human.storage_units.units."+[null,"kb","mb","gb","tb"][c]),f=0===d-Math.floor(d)?0:1);b=this.prepareOptions(b,{precision:f,format:"%n%u",delimiter:""});a=this.toNumber(d,b);return a=b.format.replace("%u",c).replace("%n",a)};
I18n.toPercentage=function(a,b){b=this.prepareOptions(b,this.lookup("number.percentage.format"),this.lookup("number.format"),{precision:3,separator:".",delimiter:""});a=this.toNumber(a,b);return a+"%"};I18n.pluralizer=function(a){pluralizer=this.pluralizationRules[a];return void 0!==pluralizer?pluralizer:this.pluralizationRules.en};I18n.findAndTranslateValidNode=function(a,b){for(i=0;i<a.length;i++)if(key=a[i],this.isValidNode(b,key))return b[key];return null};
I18n.pluralize=function(a,b,d){var c;try{c=this.lookup(b,d)}catch(f){}if(!c)return this.missingTranslation(b);d=this.prepareOptions(d);d.count=a.toString();pluralizer=this.pluralizer(this.currentLocale());key=pluralizer(Math.abs(a));keys="object"==typeof key&&key instanceof Array?key:[key];a=this.findAndTranslateValidNode(keys,c);null==a&&(a=this.missingTranslation(b,keys[0]));return this.interpolate(a,d)};
I18n.missingTranslation=function(){for(var a='[missing "'+this.currentLocale(),b=arguments.length,d=0;d<b;d++)a+="."+arguments[d];return a+'" translation]'};I18n.currentLocale=function(){return I18n.locale||I18n.defaultLocale};I18n.t=I18n.translate;I18n.l=I18n.localize;I18n.p=I18n.pluralize;
