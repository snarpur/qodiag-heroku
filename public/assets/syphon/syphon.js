Backbone.Syphon=function(a,c,f){var g={ignoredTypes:["button","submit","reset","fieldset"],serialize:function(b,a){var d={},e=m(a),k=n(b,e);f.each(k,function(b){var a=c(b),h=l(a),f=e.keyExtractors.get(h)(a);b=e.inputReaders.get(h)(a);e.keyAssignmentValidators.get(h)(a,f,b)&&(a=e.keySplitter(f),d=p(d,a,b))});return d},deserialize:function(b,a,d){var e=m(d);b=n(b,e);var k=q(e,a);f.each(b,function(b){b=c(b);var a=l(b),h=e.keyExtractors.get(a)(b);e.inputWriters.get(a)(b,k[h])})}},n=function(b,a){var d=
(f.isUndefined(b.$el)&&"form"===b.tagName.toLowerCase()?b:b.$el.is("form")?b.el:b.$("form")[0]).elements;return d=f.reject(d,function(b){var d=l(b);b=a.keyExtractors.get(d)(c(b));var d=f.include(a.ignoredTypes,d),g=f.include(a.include,b);b=f.include(a.exclude,b);return g?!1:a.include?!0:b||d})},l=function(b){b=c(b);var a=b[0].tagName,d=a;"input"===a.toLowerCase()&&(d=(b=b.attr("type"))?b:"text");return d.toLowerCase()},m=function(b){b=f.clone(b)||{};b.ignoredTypes=f.clone(g.ignoredTypes);b.inputReaders=
b.inputReaders||g.InputReaders;b.inputWriters=b.inputWriters||g.InputWriters;b.keyExtractors=b.keyExtractors||g.KeyExtractors;b.keySplitter=b.keySplitter||g.KeySplitter;b.keyJoiner=b.keyJoiner||g.KeyJoiner;b.keyAssignmentValidators=b.keyAssignmentValidators||g.KeyAssignmentValidators;return b},p=function(b,a,d){if(!a)return b;var e=a.shift();b[e]||(b[e]=f.isArray(e)?[]:{});0===a.length&&(f.isArray(b[e])?b[e].push(d):b[e]=d);0<a.length&&p(b[e],a,d);return b},q=function(b,a,d){var e={};f.each(a,function(a,
c){var g={};d&&(c=b.keyJoiner(d,c));f.isArray(a)?g[c+"[]"]=a:f.isObject(a)?g=q(b,a,c):g[c]=a;f.extend(e,g)});return e};return g}(Backbone,jQuery,_);Backbone.Syphon.TypeRegistry=function(){this.registeredTypes={}};Backbone.Syphon.TypeRegistry.extend=Backbone.Model.extend;
_.extend(Backbone.Syphon.TypeRegistry.prototype,{get:function(a){(a=this.registeredTypes[a])||(a=this.registeredTypes["default"]);return a},register:function(a,c){this.registeredTypes[a]=c},registerDefault:function(a){this.registeredTypes["default"]=a},unregister:function(a){this.registeredTypes[a]&&delete this.registeredTypes[a]}});Backbone.Syphon.KeyExtractorSet=Backbone.Syphon.TypeRegistry.extend();Backbone.Syphon.KeyExtractors=new Backbone.Syphon.KeyExtractorSet;Backbone.Syphon.KeyExtractors.registerDefault(function(a){return a.prop("name")});
Backbone.Syphon.InputReaderSet=Backbone.Syphon.TypeRegistry.extend();Backbone.Syphon.InputReaders=new Backbone.Syphon.InputReaderSet;Backbone.Syphon.InputReaders.registerDefault(function(a){return a.val()});Backbone.Syphon.InputReaders.register("checkbox",function(a){return a.prop("checked")});Backbone.Syphon.InputWriterSet=Backbone.Syphon.TypeRegistry.extend();Backbone.Syphon.InputWriters=new Backbone.Syphon.InputWriterSet;Backbone.Syphon.InputWriters.registerDefault(function(a,c){a.val(c)});
Backbone.Syphon.InputWriters.register("checkbox",function(a,c){a.prop("checked",c)});Backbone.Syphon.InputWriters.register("radio",function(a,c){a.prop("checked",a.val()===c)});Backbone.Syphon.KeyAssignmentValidatorSet=Backbone.Syphon.TypeRegistry.extend();Backbone.Syphon.KeyAssignmentValidators=new Backbone.Syphon.KeyAssignmentValidatorSet;Backbone.Syphon.KeyAssignmentValidators.registerDefault(function(){return!0});Backbone.Syphon.KeyAssignmentValidators.register("radio",function(a,c,f){return a.prop("checked")});
Backbone.Syphon.KeySplitter=function(a){var c=a.match(/[^\[\]]+/g);a.indexOf("[]")===a.length-2&&(lastKey=c.pop(),c.push([lastKey]));return c};Backbone.Syphon.KeyJoiner=function(a,c){return a+"["+c+"]"};
