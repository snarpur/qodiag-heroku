(function(a){var y=function(){var d=document.createElement("input");d.setAttribute("onpaste","");return"function"===typeof d.onpaste?"paste":"input"}()+".mask",l=navigator.userAgent,z=/iphone/i.test(l),A=/android/i.test(l),x;a.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"};a.fn.extend({caret:function(d,f){var a;if(!(0===this.length||this.is(":hidden"))){if("number"==typeof d)return f="number"===typeof f?f:d,this.each(function(){this.setSelectionRange?
this.setSelectionRange(d,f):this.createTextRange&&(a=this.createTextRange(),a.collapse(!0),a.moveEnd("character",f),a.moveStart("character",d),a.select())});this[0].setSelectionRange?(d=this[0].selectionStart,f=this[0].selectionEnd):document.selection&&document.selection.createRange&&(a=document.selection.createRange(),d=0-a.duplicate().moveStart("character",-1E5),f=d+a.text.length);return{begin:d,end:f}}},unmask:function(){return this.trigger("unmask")},mask:function(d,f){var l,t,h,n,p,m;if(!d&&
0<this.length)return l=a(this[0]),l.data(a.mask.dataName)();f=a.extend({placeholder:a.mask.placeholder,completed:null},f);t=a.mask.definitions;h=[];n=m=d.length;p=null;a.each(d.split(""),function(a,f){"?"==f?(m--,n=a):t[f]?(h.push(RegExp(t[f])),null===p&&(p=h.length-1)):h.push(null)});return this.trigger("unmask").each(function(){function q(g){for(;++g<m&&!h[g];);return g}function l(g,a){var b,c;if(!(0>g)){b=g;for(c=q(a);b<m;b++)if(h[b]){if(c<m&&h[b].test(k[c]))k[b]=k[c],k[c]=f.placeholder;else break;
c=q(c)}r();e.caret(Math.max(p,g))}}function B(g){var a=g.which,b,c;if(8===a||46===a||z&&127===a){b=e.caret();c=b.begin;b=b.end;if(0===b-c){if(46!==a)for(;0<=--c&&!h[c];);else c=b=q(c-1);b=46===a?q(b):b}u(c,b);l(c,b-1);g.preventDefault()}else 27==a&&(e.val(v),e.caret(0,s()),g.preventDefault())}function C(g){var d=g.which,b=e.caret();if(!g.ctrlKey&&(!g.altKey&&!(g.metaKey||32>d))&&d){0!==b.end-b.begin&&(u(b.begin,b.end),l(b.begin,b.end-1));b=q(b.begin-1);if(b<m&&(d=String.fromCharCode(d),h[b].test(d))){var c,
w,n,p;c=b;for(w=f.placeholder;c<m;c++)if(h[c])if(n=q(c),p=k[c],k[c]=w,n<m&&h[n].test(p))w=p;else break;k[b]=d;r();b=q(b);A?setTimeout(a.proxy(a.fn.caret,e,b),0):e.caret(b);f.completed&&b>=m&&f.completed.call(e)}g.preventDefault()}}function u(g,a){var b;for(b=g;b<a&&b<m;b++)h[b]&&(k[b]=f.placeholder)}function r(){e.val(k.join(""))}function s(a){var d=e.val(),b=-1,c,l;for(pos=c=0;c<m;c++)if(h[c]){for(k[c]=f.placeholder;pos++<d.length;)if(l=d.charAt(pos-1),h[c].test(l)){k[c]=l;b=c;break}if(pos>d.length)break}else k[c]===
d.charAt(pos)&&c!==n&&(pos++,b=c);a?r():b+1<n?(e.val(""),u(0,m)):(r(),e.val(e.val().substring(0,b+1)));return n?c:p}var e=a(this),k=a.map(d.split(""),function(a,d){if("?"!=a)return t[a]?f.placeholder:a}),v=e.val();e.data(a.mask.dataName,function(){return a.map(k,function(a,d){return h[d]&&a!=f.placeholder?a:null}).join("")});e.attr("readonly")||e.one("unmask",function(){e.unbind(".mask").removeData(a.mask.dataName)}).bind("focus.mask",function(){clearTimeout(x);var a;v=e.val();a=s();x=setTimeout(function(){r();
a==d.length?e.caret(0,a):e.caret(a)},10)}).bind("blur.mask",function(){s();e.val()!=v&&e.change()}).bind("keydown.mask",B).bind("keypress.mask",C).bind(y,function(){setTimeout(function(){var a=s(!0);e.caret(a);f.completed&&a==e.val().length&&f.completed.call(e)},0)});s()})}})})(jQuery);
