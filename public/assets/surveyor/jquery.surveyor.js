jQuery(document).ready(function(){jQuery("li.date input").change(function(){if($(this).data("dateinput")){var date_obj=$(this).data("dateinput").getValue();this.value=date_obj.getFullYear()+"-"+(date_obj.getMonth()+1)+"-"+date_obj.getDate()+" 00:00:00 UTC"}});jQuery("form#survey_form input, form#survey_form select, form#survey_form textarea").change(function(){var elements=[$('[type="submit"]').parent(),$('[name="'+this.name+'"]').closest("li")];blockElements(elements);question_data=$(this).parents('fieldset[id^="q_"],tr[id^="q_"]').find("input, select, textarea").add($("form#survey_form input[name='authenticity_token']")).serialize();$.ajax({type:"PUT",url:$(this).parents("form#survey_form").attr("action"),data:question_data,dataType:"json",success:function(response){unblockElements(elements);successfulSave(response)},error:function(xhr,ajaxOptions,thrownError){unblockElements(elements)}})});jQuery("#dependents").remove();function successfulSave(responseText){jQuery.each(responseText.show,function(){showElement(this)});jQuery.each(responseText.hide,function(){hideElement(this)});jQuery.each(responseText.ids,function(k,v){jQuery("#r_"+k+"_question_id").after('<input id="r_'+k+'_id" type="hidden" value="'+v+'" name="r['+k+'][id]"/>')});jQuery.each(responseText.remove,function(k,v){jQuery("#r_"+k+'_id[value="'+v+'"]').remove()});return false}function showElement(id){group=id.match("^g_")?true:false;if(group){jQuery("#"+id).removeClass("g_hidden")}else{jQuery("#"+id).removeClass("q_hidden")}}function hideElement(id){group=id.match("^g_")?true:false;if(group){jQuery("#"+id).addClass("g_hidden")}else{jQuery("#"+id).addClass("q_hidden")}}function blockElements(elements){$.blockUI.defaults.overlayCSS.opacity=0;$.blockUI.defaults.message=null;$.blockUI.defaults.fadeIn=0;$.blockUI.defaults.fadeOut=0;$.each(elements,function(){$(this).block()})}function unblockElements(elements){$.each(elements,function(){$(this).unblock()})}$("input.exclusive:checked").parents('fieldset[id^="q_"]').find(":checkbox").not(".exclusive").attr("checked",false).attr("disabled",true);$("input.exclusive:checkbox").click(function(){var e=$(this);var others=e.parents('fieldset[id^="q_"]').find(":checkbox").not(".exclusive");if(e.is(":checked")){others.attr("checked",false).attr("disabled",true)}else{others.attr("disabled",false)}});$("li.date input").dateinput({format:"dd mmm yyyy"})});