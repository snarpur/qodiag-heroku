var I18n=I18n||{};I18n.defaultLocale="en";I18n.fallbacks=!1;I18n.defaultSeparator=".";I18n.locale=null;I18n.PLACEHOLDER=/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm;I18n.isValidNode=function(b,a,e){return null!==b[a]&&b[a]!==e};
I18n.lookup=function(b,a){a=a||{};var e=b,c=this.prepareOptions(I18n.translations)[a.locale||I18n.currentLocale()];a=this.prepareOptions(a);var f;if(c){"object"==typeof b&&(b=b.join(this.defaultSeparator));a.scope&&(b=a.scope.toString()+this.defaultSeparator+b);for(b=b.split(this.defaultSeparator);0<b.length;)if(f=b.shift(),c=c[f],!c){I18n.fallbacks&&!a.fallback&&(c=I18n.lookup(e,this.prepareOptions({locale:I18n.defaultLocale,fallback:!0},a)));break}!c&&this.isValidNode(a,"defaultValue")&&(c=a.defaultValue);
return c}};I18n.prepareOptions=function(){for(var b={},a,e=arguments.length,c=0;c<e;c++)if(a=arguments[c])for(var f in a)this.isValidNode(b,f)||(b[f]=a[f]);return b};I18n.interpolate=function(b,a){a=this.prepareOptions(a);var e=b.match(this.PLACEHOLDER),c,f,h;if(!e)return b;for(var k=0;c=e[k];k++)h=c.replace(this.PLACEHOLDER,"$1"),f=a[h],this.isValidNode(a,h)||(f="[missing "+c+" value]"),regex=RegExp(c.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}")),b=b.replace(regex,f);return b};
I18n.translate=function(b,a){a=this.prepareOptions(a);var e=this.lookup(b,a);try{return"object"==typeof e?"number"==typeof a.count?this.pluralize(a.count,b,a):e:this.interpolate(e,a)}catch(c){return this.missingTranslation(b)}};I18n.localize=function(b,a){switch(b){case "currency":return this.toCurrency(a);case "number":return b=this.lookup("number.format"),this.toNumber(a,b);case "percentage":return this.toPercentage(a);default:return b.match(/^(date|time)/)?this.toTime(b,a):a.toString()}};
I18n.parseDate=function(b){var a;if("object"==typeof b)return b;if(a=b.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2}))?(Z|\+0000)?/)){for(b=1;6>=b;b++)a[b]=parseInt(a[b],10)||0;a[2]-=1;a=a[7]?new Date(Date.UTC(a[1],a[2],a[3],a[4],a[5],a[6])):new Date(a[1],a[2],a[3],a[4],a[5],a[6])}else"number"==typeof b?(a=new Date,a.setTime(b)):(b.match(/\d+ \d+:\d+:\d+ [+-]\d+ \d+/),a=new Date,a.setTime(Date.parse(b)));return a};
I18n.toTime=function(b,a){var e=this.parseDate(a),c=this.lookup(b);return e.toString().match(/invalid/i)||!c?e.toString():this.strftime(e,c)};
I18n.strftime=function(b,a){var e=this.lookup("date");if(!e)return b.toString();e.meridian=e.meridian||["AM","PM"];var c=b.getDay(),f=b.getDate(),h=b.getFullYear(),k=b.getMonth()+1,n=b.getHours(),l=n,r=11<n?1:0,p=b.getSeconds(),q=b.getMinutes(),m=b.getTimezoneOffset(),g=Math.floor(Math.abs(m/60)),d=Math.abs(m)-60*g,m=(0<m?"-":"+")+(2>g.toString().length?"0"+g:g)+(2>d.toString().length?"0"+d:d);12<l?l-=12:0===l&&(l=12);g=function(a){a="0"+a.toString();return a.substr(a.length-2)};d=a.replace("%a",
e.abbr_day_names[c]);d=d.replace("%A",e.day_names[c]);d=d.replace("%b",e.abbr_month_names[k]);d=d.replace("%B",e.month_names[k]);d=d.replace("%d",g(f));d=d.replace("%e",f);d=d.replace("%-d",f);d=d.replace("%H",g(n));d=d.replace("%-H",n);d=d.replace("%I",g(l));d=d.replace("%-I",l);d=d.replace("%m",g(k));d=d.replace("%-m",k);d=d.replace("%M",g(q));d=d.replace("%-M",q);d=d.replace("%p",e.meridian[r]);d=d.replace("%S",g(p));d=d.replace("%-S",p);d=d.replace("%w",c);d=d.replace("%y",g(h));d=d.replace("%-y",
g(h).replace(/^0+/,""));d=d.replace("%Y",h);return d=d.replace("%z",m)};
I18n.toNumber=function(b,a){a=this.prepareOptions(a,this.lookup("number.format"),{precision:3,separator:".",delimiter:",",strip_insignificant_zeros:!1});var e=0>b,c=Math.abs(b).toFixed(a.precision).toString().split("."),f=[];for(b=c[0];0<b.length;)f.unshift(b.substr(Math.max(0,b.length-3),3)),b=b.substr(0,b.length-3);f=f.join(a.delimiter);0<a.precision&&(f+=a.separator+c[1]);e&&(f="-"+f);a.strip_insignificant_zeros&&(e=RegExp(a.separator.replace(/\./,"\\.")+"$"),f=f.replace(/0+$/,"").replace(e,""));
return f};I18n.toCurrency=function(b,a){a=this.prepareOptions(a,this.lookup("number.currency.format"),this.lookup("number.format"),{unit:"$",precision:2,format:"%u%n",delimiter:",",separator:"."});b=this.toNumber(b,a);return b=a.format.replace("%u",a.unit).replace("%n",b)};
I18n.toHumanSize=function(b,a){for(var e=b,c=0,f;1024<=e&&4>c;)e/=1024,c+=1;0===c?(c=this.t("number.human.storage_units.units.byte",{count:e}),f=0):(c=this.t("number.human.storage_units.units."+[null,"kb","mb","gb","tb"][c]),f=0===e-Math.floor(e)?0:1);a=this.prepareOptions(a,{precision:f,format:"%n%u",delimiter:""});b=this.toNumber(e,a);return b=a.format.replace("%u",c).replace("%n",b)};
I18n.toPercentage=function(b,a){a=this.prepareOptions(a,this.lookup("number.percentage.format"),this.lookup("number.format"),{precision:3,separator:".",delimiter:""});b=this.toNumber(b,a);return b+"%"};
I18n.pluralize=function(b,a,e){var c;try{c=this.lookup(a,e)}catch(f){}if(!c)return this.missingTranslation(a);e=this.prepareOptions(e);e.count=b.toString();switch(Math.abs(b)){case 0:b=this.isValidNode(c,"zero")?c.zero:this.isValidNode(c,"none")?c.none:this.isValidNode(c,"other")?c.other:this.missingTranslation(a,"zero");break;case 1:b=this.isValidNode(c,"one")?c.one:this.missingTranslation(a,"one");break;default:b=this.isValidNode(c,"other")?c.other:this.missingTranslation(a,"other")}return this.interpolate(b,
e)};I18n.missingTranslation=function(){for(var b='[missing "'+this.currentLocale(),a=arguments.length,e=0;e<a;e++)b+="."+arguments[e];return b+'" translation]'};I18n.currentLocale=function(){return I18n.locale||I18n.defaultLocale};I18n.t=I18n.translate;I18n.l=I18n.localize;I18n.p=I18n.pluralize;
