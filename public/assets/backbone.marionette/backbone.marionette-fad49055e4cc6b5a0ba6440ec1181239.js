/*!
 * Includes BabySitter
 * https://github.com/marionettejs/backbone.babysitter/
 *
 * Includes Wreqr
 * https://github.com/marionettejs/backbone.wreqr/
 */
;Backbone.ChildViewContainer=(function(Backbone,_){var Container=function(initialViews){this._views={};this._indexByModel={};this._indexByCollection={};this._indexByCustom={};this._updateLength();this._addInitialViews(initialViews)};_.extend(Container.prototype,{add:function(view,customIndex){var viewCid=view.cid;this._views[viewCid]=view;if(view.model){this._indexByModel[view.model.cid]=viewCid}if(view.collection){this._indexByCollection[view.collection.cid]=viewCid}if(customIndex){this._indexByCustom[customIndex]=viewCid}this._updateLength()},findByModel:function(model){var viewCid=this._indexByModel[model.cid];return this.findByCid(viewCid)},findByCollection:function(col){var viewCid=this._indexByCollection[col.cid];return this.findByCid(viewCid)},findByCustom:function(index){var viewCid=this._indexByCustom[index];return this.findByCid(viewCid)},findByIndex:function(index){return _.values(this._views)[index]},findByCid:function(cid){return this._views[cid]},remove:function(view){var viewCid=view.cid;if(view.model){delete this._indexByModel[view.model.cid]}if(view.collection){delete this._indexByCollection[view.collection.cid]}var cust;for(var key in this._indexByCustom){if(this._indexByCustom.hasOwnProperty(key)){if(this._indexByCustom[key]===viewCid){cust=key;break}}}if(cust){delete this._indexByCustom[cust]}delete this._views[viewCid];this._updateLength()},call:function(method,args){args=Array.prototype.slice.call(arguments,1);this.apply(method,args)},apply:function(method,args){var view;args=args||[];_.each(this._views,function(view,key){if(_.isFunction(view[method])){view[method].apply(view,args)}})},_updateLength:function(){this.length=_.size(this._views)},_addInitialViews:function(views){if(!views){return}var view,i,length=views.length;for(i=0;i<length;i++){view=views[i];this.add(view)}}});var methods=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];_.each(methods,function(method){Container.prototype[method]=function(){var views=_.values(this._views);var args=[views].concat(_.toArray(arguments));return _[method].apply(_,args)}});return Container})(Backbone,_);Backbone.Wreqr=(function(Backbone,Marionette,_){var Wreqr={};Wreqr.Handlers=(function(Backbone,_){var Handlers=function(options){this.options=options;this._wreqrHandlers={};if(_.isFunction(this.initialize)){this.initialize(options)}};Handlers.extend=Backbone.Model.extend;_.extend(Handlers.prototype,Backbone.Events,{setHandlers:function(handlers){_.each(handlers,function(handler,name){var context=null;if(_.isObject(handler)&&!_.isFunction(handler)){context=handler.context;handler=handler.callback}this.setHandler(name,handler,context)},this)},setHandler:function(name,handler,context){var config={callback:handler,context:context};this._wreqrHandlers[name]=config;this.trigger("handler:add",name,handler,context)},hasHandler:function(name){return !!this._wreqrHandlers[name]},getHandler:function(name){var config=this._wreqrHandlers[name];if(!config){throw new Error("Handler not found for '"+name+"'")}return function(){var args=Array.prototype.slice.apply(arguments);return config.callback.apply(config.context,args)}},removeHandler:function(name){delete this._wreqrHandlers[name]},removeAllHandlers:function(){this._wreqrHandlers={}}});return Handlers})(Backbone,_);Wreqr.CommandStorage=(function(){var CommandStorage=function(options){this.options=options;this._commands={};if(_.isFunction(this.initialize)){this.initialize(options)}};_.extend(CommandStorage.prototype,Backbone.Events,{getCommands:function(commandName){var commands=this._commands[commandName];if(!commands){commands={command:commandName,instances:[]};this._commands[commandName]=commands}return commands},addCommand:function(commandName,args){var command=this.getCommands(commandName);command.instances.push(args)},clearCommands:function(commandName){var command=this.getCommands(commandName);command.instances=[]}});return CommandStorage})();Wreqr.Commands=(function(Wreqr){return Wreqr.Handlers.extend({storageType:Wreqr.CommandStorage,constructor:function(options){this.options=options||{};this._initializeStorage(this.options);this.on("handler:add",this._executeCommands,this);var args=Array.prototype.slice.call(arguments);Wreqr.Handlers.prototype.constructor.apply(this,args)},execute:function(name,args){name=arguments[0];args=Array.prototype.slice.call(arguments,1);if(this.hasHandler(name)){this.getHandler(name).apply(this,args)}else{this.storage.addCommand(name,args)}},_executeCommands:function(name,handler,context){var command=this.storage.getCommands(name);_.each(command.instances,function(args){handler.apply(context,args)});this.storage.clearCommands(name)},_initializeStorage:function(options){var storage;var StorageType=options.storageType||this.storageType;if(_.isFunction(StorageType)){storage=new StorageType()}else{storage=StorageType}this.storage=storage}})})(Wreqr);Wreqr.RequestResponse=(function(Wreqr){return Wreqr.Handlers.extend({request:function(){var name=arguments[0];var args=Array.prototype.slice.call(arguments,1);return this.getHandler(name).apply(this,args)}})})(Wreqr);Wreqr.EventAggregator=(function(Backbone,_){var EA=function(){};EA.extend=Backbone.Model.extend;_.extend(EA.prototype,Backbone.Events);return EA})(Backbone,_);return Wreqr})(Backbone,Backbone.Marionette,_);var Marionette=(function(global,Backbone,_){var Marionette={};Backbone.Marionette=Marionette;Marionette.$=Backbone.$;var protoSlice=Array.prototype.slice;function slice(args){return protoSlice.call(args)}function throwError(message,name){var error=new Error(message);error.name=name||"Error";throw error}Marionette.extend=Backbone.Model.extend;Marionette.getOption=function(target,optionName){if(!target||!optionName){return}var value;if(target.options&&(optionName in target.options)&&(target.options[optionName]!==undefined)){value=target.options[optionName]}else{value=target[optionName]}return value};Marionette.triggerMethod=(function(){var splitter=/(^|:)(\w)/gi;function getEventName(match,prefix,eventName){return eventName.toUpperCase()}var triggerMethod=function(event){var methodName="on"+event.replace(splitter,getEventName);var method=this[methodName];this.trigger.apply(this,arguments);if(_.isFunction(method)){return method.apply(this,_.tail(arguments))}};return triggerMethod})();Marionette.MonitorDOMRefresh=(function(){function handleShow(view){view._isShown=true;triggerDOMRefresh(view)}function handleRender(view){view._isRendered=true;triggerDOMRefresh(view)}function triggerDOMRefresh(view){if(view._isShown&&view._isRendered){if(_.isFunction(view.triggerMethod)){view.triggerMethod("dom:refresh")}}}return function(view){view.listenTo(view,"show",function(){handleShow(view)});view.listenTo(view,"render",function(){handleRender(view)})}})();(function(Marionette){function bindFromStrings(target,entity,evt,methods){var methodNames=methods.split(/\s+/);_.each(methodNames,function(methodName){var method=target[methodName];if(!method){throwError("Method '"+methodName+"' was configured as an event handler, but does not exist.")}target.listenTo(entity,evt,method,target)})}function bindToFunction(target,entity,evt,method){target.listenTo(entity,evt,method,target)}function unbindFromStrings(target,entity,evt,methods){var methodNames=methods.split(/\s+/);_.each(methodNames,function(methodName){var method=target[method];target.stopListening(entity,evt,method,target)})}function unbindToFunction(target,entity,evt,method){target.stopListening(entity,evt,method,target)}function iterateEvents(target,entity,bindings,functionCallback,stringCallback){if(!entity||!bindings){return}if(_.isFunction(bindings)){bindings=bindings.call(target)}_.each(bindings,function(methods,evt){if(_.isFunction(methods)){functionCallback(target,entity,evt,methods)}else{stringCallback(target,entity,evt,methods)}})}Marionette.bindEntityEvents=function(target,entity,bindings){iterateEvents(target,entity,bindings,bindToFunction,bindFromStrings)};Marionette.unbindEntityEvents=function(target,entity,bindings){iterateEvents(target,entity,bindings,unbindToFunction,unbindFromStrings)}})(Marionette);Marionette.Callbacks=function(){this._deferred=Marionette.$.Deferred();this._callbacks=[]};_.extend(Marionette.Callbacks.prototype,{add:function(callback,contextOverride){this._callbacks.push({cb:callback,ctx:contextOverride});this._deferred.done(function(context,options){if(contextOverride){context=contextOverride}callback.call(context,options)})},run:function(options,context){this._deferred.resolve(context,options)},reset:function(){var callbacks=this._callbacks;this._deferred=Marionette.$.Deferred();this._callbacks=[];_.each(callbacks,function(cb){this.add(cb.cb,cb.ctx)},this)}});Marionette.Controller=function(options){this.triggerMethod=Marionette.triggerMethod;this.options=options||{};if(_.isFunction(this.initialize)){this.initialize(this.options)}};Marionette.Controller.extend=Marionette.extend;_.extend(Marionette.Controller.prototype,Backbone.Events,{close:function(){this.stopListening();this.triggerMethod("close");this.unbind()}});Marionette.Region=function(options){this.options=options||{};this.el=Marionette.getOption(this,"el");if(!this.el){var err=new Error("An 'el' must be specified for a region.");err.name="NoElError";throw err}if(this.initialize){var args=Array.prototype.slice.apply(arguments);this.initialize.apply(this,args)}};_.extend(Marionette.Region,{buildRegion:function(regionConfig,defaultRegionType){var regionIsString=(typeof regionConfig==="string");var regionSelectorIsString=(typeof regionConfig.selector==="string");var regionTypeIsUndefined=(typeof regionConfig.regionType==="undefined");var regionIsType=(typeof regionConfig==="function");if(!regionIsType&&!regionIsString&&!regionSelectorIsString){throw new Error("Region must be specified as a Region type, a selector string or an object with selector property")}var selector,RegionType;if(regionIsString){selector=regionConfig}if(regionConfig.selector){selector=regionConfig.selector}if(regionIsType){RegionType=regionConfig}if(!regionIsType&&regionTypeIsUndefined){RegionType=defaultRegionType}if(regionConfig.regionType){RegionType=regionConfig.regionType}var region=new RegionType({el:selector});if(regionConfig.parentEl){region.getEl=function(selector){var parentEl=regionConfig.parentEl;if(_.isFunction(parentEl)){parentEl=parentEl()}return parentEl.find(selector)}}return region}});_.extend(Marionette.Region.prototype,Backbone.Events,{show:function(view){this.ensureEl();if(view!==this.currentView){this.close();view.render();this.open(view)}else{view.render()}Marionette.triggerMethod.call(view,"show");Marionette.triggerMethod.call(this,"show",view);this.currentView=view},ensureEl:function(){if(!this.$el||this.$el.length===0){this.$el=this.getEl(this.el)}},getEl:function(selector){return Marionette.$(selector)},open:function(view){this.$el.empty().append(view.el)},close:function(){var view=this.currentView;if(!view||view.isClosed){return}if(view.close){view.close()}else{if(view.remove){view.remove()}}Marionette.triggerMethod.call(this,"close");delete this.currentView},attachView:function(view){this.currentView=view},reset:function(){this.close();delete this.$el}});Marionette.Region.extend=Marionette.extend;Marionette.RegionManager=(function(Marionette){var RegionManager=Marionette.Controller.extend({constructor:function(options){this._regions={};Marionette.Controller.prototype.constructor.call(this,options)},addRegions:function(regionDefinitions,defaults){var regions={};_.each(regionDefinitions,function(definition,name){if(typeof definition==="string"){definition={selector:definition}}if(definition.selector){definition=_.defaults({},definition,defaults)}var region=this.addRegion(name,definition);regions[name]=region},this);return regions},addRegion:function(name,definition){var region;var isObject=_.isObject(definition);var isString=_.isString(definition);var hasSelector=!!definition.selector;if(isString||(isObject&&hasSelector)){region=Marionette.Region.buildRegion(definition,Marionette.Region)}else{if(_.isFunction(definition)){region=Marionette.Region.buildRegion(definition,Marionette.Region)}else{region=definition}}this._store(name,region);this.triggerMethod("region:add",name,region);return region},get:function(name){return this._regions[name]},removeRegion:function(name){var region=this._regions[name];this._remove(name,region)},removeRegions:function(){_.each(this._regions,function(region,name){this._remove(name,region)},this)},closeRegions:function(){_.each(this._regions,function(region,name){region.close()},this)},close:function(){this.removeRegions();var args=Array.prototype.slice.call(arguments);Marionette.Controller.prototype.close.apply(this,args)},_store:function(name,region){this._regions[name]=region;this.length=_.size(this._regions)},_remove:function(name,region){region.close();delete this._regions[name];this.triggerMethod("region:remove",name,region)}});var methods=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];_.each(methods,function(method){RegionManager.prototype[method]=function(){var regions=_.values(this._regions);var args=[regions].concat(_.toArray(arguments));return _[method].apply(_,args)}});return RegionManager})(Marionette);Marionette.TemplateCache=function(templateId){this.templateId=templateId};_.extend(Marionette.TemplateCache,{templateCaches:{},get:function(templateId){var cachedTemplate=this.templateCaches[templateId];if(!cachedTemplate){cachedTemplate=new Marionette.TemplateCache(templateId);this.templateCaches[templateId]=cachedTemplate}return cachedTemplate.load()},clear:function(){var i;var args=slice(arguments);var length=args.length;if(length>0){for(i=0;i<length;i++){delete this.templateCaches[args[i]]}}else{this.templateCaches={}}}});_.extend(Marionette.TemplateCache.prototype,{load:function(){if(this.compiledTemplate){return this.compiledTemplate}var template=this.loadTemplate(this.templateId);this.compiledTemplate=this.compileTemplate(template);return this.compiledTemplate},loadTemplate:function(templateId){var template=Marionette.$(templateId).html();if(!template||template.length===0){throwError("Could not find template: '"+templateId+"'","NoTemplateError")}return template},compileTemplate:function(rawTemplate){return _.template(rawTemplate)}});Marionette.Renderer={render:function(template,data){var templateFunc=typeof template==="function"?template:Marionette.TemplateCache.get(template);return templateFunc(data)}};Marionette.View=Backbone.View.extend({constructor:function(){_.bindAll(this,"render");var args=Array.prototype.slice.apply(arguments);Backbone.View.prototype.constructor.apply(this,args);Marionette.MonitorDOMRefresh(this);this.listenTo(this,"show",this.onShowCalled,this)},triggerMethod:Marionette.triggerMethod,getTemplate:function(){return Marionette.getOption(this,"template")},mixinTemplateHelpers:function(target){target=target||{};var templateHelpers=this.templateHelpers;if(_.isFunction(templateHelpers)){templateHelpers=templateHelpers.call(this)}return _.extend(target,templateHelpers)},configureTriggers:function(){if(!this.triggers){return}var triggerEvents={};var triggers=_.result(this,"triggers");_.each(triggers,function(value,key){triggerEvents[key]=function(e){if(e&&e.preventDefault){e.preventDefault()}if(e&&e.stopPropagation){e.stopPropagation()}var args={view:this,model:this.model,collection:this.collection};this.triggerMethod(value,args)}},this);return triggerEvents},delegateEvents:function(events){this._delegateDOMEvents(events);Marionette.bindEntityEvents(this,this.model,Marionette.getOption(this,"modelEvents"));Marionette.bindEntityEvents(this,this.collection,Marionette.getOption(this,"collectionEvents"))},_delegateDOMEvents:function(events){events=events||this.events;if(_.isFunction(events)){events=events.call(this)}var combinedEvents={};var triggers=this.configureTriggers();_.extend(combinedEvents,events,triggers);Backbone.View.prototype.delegateEvents.call(this,combinedEvents)},undelegateEvents:function(){var args=Array.prototype.slice.call(arguments);Backbone.View.prototype.undelegateEvents.apply(this,args);Marionette.unbindEntityEvents(this,this.model,Marionette.getOption(this,"modelEvents"));Marionette.unbindEntityEvents(this,this.collection,Marionette.getOption(this,"collectionEvents"))},onShowCalled:function(){},close:function(){if(this.isClosed){return}var shouldClose=this.triggerMethod("before:close");if(shouldClose===false){return}this.isClosed=true;this.triggerMethod("close");this.unbindUIElements();this.remove()},bindUIElements:function(){if(!this.ui){return}if(!this._uiBindings){this._uiBindings=this.ui}var bindings=_.result(this,"_uiBindings");this.ui={};_.each(_.keys(bindings),function(key){var selector=bindings[key];this.ui[key]=this.$(selector)},this)},unbindUIElements:function(){if(!this.ui){return}_.each(this.ui,function($el,name){delete this.ui[name]},this);this.ui=this._uiBindings;delete this._uiBindings}});Marionette.ItemView=Marionette.View.extend({constructor:function(){Marionette.View.prototype.constructor.apply(this,slice(arguments))},serializeData:function(){var data={};if(this.model){data=this.model.toJSON()}else{if(this.collection){data={items:this.collection.toJSON()}}}return data},render:function(){this.isClosed=false;this.triggerMethod("before:render",this);this.triggerMethod("item:before:render",this);var data=this.serializeData();data=this.mixinTemplateHelpers(data);var template=this.getTemplate();var html=Marionette.Renderer.render(template,data);this.$el.html(html);this.bindUIElements();this.triggerMethod("render",this);this.triggerMethod("item:rendered",this);return this},close:function(){if(this.isClosed){return}this.triggerMethod("item:before:close");Marionette.View.prototype.close.apply(this,slice(arguments));this.triggerMethod("item:closed")}});Marionette.CollectionView=Marionette.View.extend({itemViewEventPrefix:"itemview",constructor:function(options){this._initChildViewStorage();Marionette.View.prototype.constructor.apply(this,slice(arguments));this._initialEvents()},_initialEvents:function(){if(this.collection){this.listenTo(this.collection,"add",this.addChildView,this);this.listenTo(this.collection,"remove",this.removeItemView,this);this.listenTo(this.collection,"reset",this.render,this)}},addChildView:function(item,collection,options){this.closeEmptyView();var ItemView=this.getItemView(item);var index=this.collection.indexOf(item);this.addItemView(item,ItemView,index)},onShowCalled:function(){this.children.each(function(child){Marionette.triggerMethod.call(child,"show")})},triggerBeforeRender:function(){this.triggerMethod("before:render",this);this.triggerMethod("collection:before:render",this)},triggerRendered:function(){this.triggerMethod("render",this);this.triggerMethod("collection:rendered",this)},render:function(){this.isClosed=false;this.triggerBeforeRender();this._renderChildren();this.triggerRendered();return this},_renderChildren:function(){this.closeEmptyView();this.closeChildren();if(this.collection&&this.collection.length>0){this.showCollection()}else{this.showEmptyView()}},showCollection:function(){var ItemView;this.collection.each(function(item,index){ItemView=this.getItemView(item);this.addItemView(item,ItemView,index)},this)},showEmptyView:function(){var EmptyView=Marionette.getOption(this,"emptyView");if(EmptyView&&!this._showingEmptyView){this._showingEmptyView=true;var model=new Backbone.Model();this.addItemView(model,EmptyView,0)}},closeEmptyView:function(){if(this._showingEmptyView){this.closeChildren();delete this._showingEmptyView}},getItemView:function(item){var itemView=Marionette.getOption(this,"itemView");if(!itemView){throwError("An `itemView` must be specified","NoItemViewError")}return itemView},addItemView:function(item,ItemView,index){var itemViewOptions=Marionette.getOption(this,"itemViewOptions");if(_.isFunction(itemViewOptions)){itemViewOptions=itemViewOptions.call(this,item,index)}var view=this.buildItemView(item,ItemView,itemViewOptions);this.addChildViewEventForwarding(view);this.triggerMethod("before:item:added",view);this.children.add(view);this.renderItemView(view,index);if(this._isShown){Marionette.triggerMethod.call(view,"show")}this.triggerMethod("after:item:added",view)},addChildViewEventForwarding:function(view){var prefix=Marionette.getOption(this,"itemViewEventPrefix");this.listenTo(view,"all",function(){var args=slice(arguments);args[0]=prefix+":"+args[0];args.splice(1,0,view);Marionette.triggerMethod.apply(this,args)},this)},renderItemView:function(view,index){view.render();this.appendHtml(this,view,index)},buildItemView:function(item,ItemViewType,itemViewOptions){var options=_.extend({model:item},itemViewOptions);return new ItemViewType(options)},removeItemView:function(item){var view=this.children.findByModel(item);this.removeChildView(view);this.checkEmpty()},removeChildView:function(view){if(view){this.stopListening(view);if(view.close){view.close()}else{if(view.remove){view.remove()}}this.children.remove(view)}this.triggerMethod("item:removed",view)},checkEmpty:function(){if(!this.collection||this.collection.length===0){this.showEmptyView()}},appendHtml:function(collectionView,itemView,index){collectionView.$el.append(itemView.el)},_initChildViewStorage:function(){this.children=new Backbone.ChildViewContainer()},close:function(){if(this.isClosed){return}this.triggerMethod("collection:before:close");this.closeChildren();this.triggerMethod("collection:closed");Marionette.View.prototype.close.apply(this,slice(arguments))},closeChildren:function(){this.children.each(function(child){this.removeChildView(child)},this);this.checkEmpty()}});Marionette.CompositeView=Marionette.CollectionView.extend({constructor:function(options){Marionette.CollectionView.apply(this,slice(arguments));this.itemView=this.getItemView()},_initialEvents:function(){if(this.collection){this.listenTo(this.collection,"add",this.addChildView,this);this.listenTo(this.collection,"remove",this.removeItemView,this);this.listenTo(this.collection,"reset",this._renderChildren,this)}},getItemView:function(item){var itemView=Marionette.getOption(this,"itemView")||this.constructor;if(!itemView){throwError("An `itemView` must be specified","NoItemViewError")}return itemView},serializeData:function(){var data={};if(this.model){data=this.model.toJSON()}return data},render:function(){this.isRendered=true;this.isClosed=false;this.resetItemViewContainer();this.triggerBeforeRender();var html=this.renderModel();this.$el.html(html);this.bindUIElements();this.triggerMethod("composite:model:rendered");this._renderChildren();this.triggerMethod("composite:rendered");this.triggerRendered();return this},_renderChildren:function(){if(this.isRendered){Marionette.CollectionView.prototype._renderChildren.call(this);this.triggerMethod("composite:collection:rendered")}},renderModel:function(){var data={};data=this.serializeData();data=this.mixinTemplateHelpers(data);var template=this.getTemplate();return Marionette.Renderer.render(template,data)},appendHtml:function(cv,iv){var $container=this.getItemViewContainer(cv);$container.append(iv.el)},getItemViewContainer:function(containerView){if("$itemViewContainer" in containerView){return containerView.$itemViewContainer}var container;if(containerView.itemViewContainer){var selector=_.result(containerView,"itemViewContainer");container=containerView.$(selector);if(container.length<=0){throwError("The specified `itemViewContainer` was not found: "+containerView.itemViewContainer,"ItemViewContainerMissingError")}}else{container=containerView.$el}containerView.$itemViewContainer=container;return container},resetItemViewContainer:function(){if(this.$itemViewContainer){delete this.$itemViewContainer}}});Marionette.Layout=Marionette.ItemView.extend({regionType:Marionette.Region,constructor:function(options){options=options||{};this._firstRender=true;this._initializeRegions(options);Marionette.ItemView.call(this,options)},render:function(){if(this._firstRender){this._firstRender=false}else{if(this.isClosed){this._initializeRegions()}else{this._reInitializeRegions()}}var args=Array.prototype.slice.apply(arguments);var result=Marionette.ItemView.prototype.render.apply(this,args);return result},close:function(){if(this.isClosed){return}this.regionManager.close();var args=Array.prototype.slice.apply(arguments);Marionette.ItemView.prototype.close.apply(this,args)},addRegion:function(name,definition){var regions={};regions[name]=definition;return this.addRegions(regions)[name]},addRegions:function(regions){this.regions=_.extend(this.regions||{},regions);return this._buildRegions(regions)},removeRegion:function(name){return this.regionManager.removeRegion(name)},_buildRegions:function(regions){var that=this;var defaults={parentEl:function(){return that.$el}};return this.regionManager.addRegions(regions,defaults)},_initializeRegions:function(options){var regions;this._initRegionManager();if(_.isFunction(this.regions)){regions=this.regions(options)}else{regions=this.regions||{}}this.addRegions(regions)},_reInitializeRegions:function(){this.regionManager.closeRegions();this.regionManager.each(function(region){region.reset()})},_initRegionManager:function(){this.regionManager=new Marionette.RegionManager();this.listenTo(this.regionManager,"region:add",function(name,region){this[name]=region;this.trigger("region:add",name,region)});this.listenTo(this.regionManager,"region:remove",function(name,region){delete this[name];this.trigger("region:remove",name,region)})}});Marionette.AppRouter=Backbone.Router.extend({constructor:function(options){Backbone.Router.prototype.constructor.apply(this,slice(arguments));this.options=options;if(this.appRoutes){var controller=Marionette.getOption(this,"controller");this.processAppRoutes(controller,this.appRoutes)}},processAppRoutes:function(controller,appRoutes){var routeNames=_.keys(appRoutes).reverse();_.each(routeNames,function(route){var methodName=appRoutes[route];var method=controller[methodName];if(!method){throw new Error("Method '"+methodName+"' was not found on the controller")}this.route(route,methodName,_.bind(method,controller))},this)}});Marionette.Application=function(options){this._initRegionManager();this._initCallbacks=new Marionette.Callbacks();this.vent=new Backbone.Wreqr.EventAggregator();this.commands=new Backbone.Wreqr.Commands();this.reqres=new Backbone.Wreqr.RequestResponse();this.submodules={};_.extend(this,options);this.triggerMethod=Marionette.triggerMethod};_.extend(Marionette.Application.prototype,Backbone.Events,{execute:function(){var args=Array.prototype.slice.apply(arguments);this.commands.execute.apply(this.commands,args)},request:function(){var args=Array.prototype.slice.apply(arguments);return this.reqres.request.apply(this.reqres,args)},addInitializer:function(initializer){this._initCallbacks.add(initializer)},start:function(options){this.triggerMethod("initialize:before",options);this._initCallbacks.run(options,this);this.triggerMethod("initialize:after",options);this.triggerMethod("start",options)},addRegions:function(regions){return this._regionManager.addRegions(regions)},removeRegion:function(region){this._regionManager.removeRegion(region)},module:function(moduleNames,moduleDefinition){var args=slice(arguments);args.unshift(this);return Marionette.Module.create.apply(Marionette.Module,args)},_initRegionManager:function(){this._regionManager=new Marionette.RegionManager();this.listenTo(this._regionManager,"region:add",function(name,region){this[name]=region});this.listenTo(this._regionManager,"region:remove",function(name,region){delete this[name]})}});Marionette.Application.extend=Marionette.extend;Marionette.Module=function(moduleName,app){this.moduleName=moduleName;this.submodules={};this._setupInitializersAndFinalizers();this.app=app;this.startWithParent=true;this.triggerMethod=Marionette.triggerMethod};_.extend(Marionette.Module.prototype,Backbone.Events,{addInitializer:function(callback){this._initializerCallbacks.add(callback)},addFinalizer:function(callback){this._finalizerCallbacks.add(callback)},start:function(options){if(this._isInitialized){return}_.each(this.submodules,function(mod){if(mod.startWithParent){mod.start(options)}});this.triggerMethod("before:start",options);this._initializerCallbacks.run(options,this);this._isInitialized=true;this.triggerMethod("start",options)},stop:function(){if(!this._isInitialized){return}this._isInitialized=false;Marionette.triggerMethod.call(this,"before:stop");_.each(this.submodules,function(mod){mod.stop()});this._finalizerCallbacks.run(undefined,this);this._initializerCallbacks.reset();this._finalizerCallbacks.reset();Marionette.triggerMethod.call(this,"stop")},addDefinition:function(moduleDefinition,customArgs){this._runModuleDefinition(moduleDefinition,customArgs)},_runModuleDefinition:function(definition,customArgs){if(!definition){return}var args=_.flatten([this,this.app,Backbone,Marionette,Marionette.$,_,customArgs]);definition.apply(this,args)},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new Marionette.Callbacks();this._finalizerCallbacks=new Marionette.Callbacks()}});_.extend(Marionette.Module,{create:function(app,moduleNames,moduleDefinition){var module=app;var customArgs=slice(arguments);customArgs.splice(0,3);moduleNames=moduleNames.split(".");var length=moduleNames.length;var moduleDefinitions=[];moduleDefinitions[length-1]=moduleDefinition;_.each(moduleNames,function(moduleName,i){var parentModule=module;module=this._getModule(parentModule,moduleName,app);this._addModuleDefinition(parentModule,module,moduleDefinitions[i],customArgs)},this);return module},_getModule:function(parentModule,moduleName,app,def,args){var module=parentModule[moduleName];if(!module){module=new Marionette.Module(moduleName,app);parentModule[moduleName]=module;parentModule.submodules[moduleName]=module}return module},_addModuleDefinition:function(parentModule,module,def,args){var fn;var startWithParent;if(_.isFunction(def)){fn=def;startWithParent=true}else{if(_.isObject(def)){fn=def.define;startWithParent=def.startWithParent}else{startWithParent=true}}if(fn){module.addDefinition(fn,args)}module.startWithParent=module.startWithParent&&startWithParent;if(module.startWithParent&&!module.startWithParentIsConfigured){module.startWithParentIsConfigured=true;parentModule.addInitializer(function(options){if(module.startWithParent){module.start(options)}})}}});return Marionette})(this,Backbone,_);