= form_for @person do |f|
  
  %input{:type => "hidden", :name => "next_step", :value  => @wizard.next_step_no}
  
  =f.fields_for :relationships, @person.relationships do |relationship_form|
    =relationship_form.hidden_field :relation_id, :value => @patient.id
    =relationship_form.hidden_field :name, :value => "parent"

    =f.hidden_field :sex, :value  => set_parent_gender(@wizard.current_step)
    =f.hidden_field :ispatient, :value  => 0


  - content_for :jstemplates do
    -spouse_partial = {:partial => "spouse_relationship"}
    != "var spouse_relationship ='#{generate_template(f, :relationships, spouse_partial)}'"
    -guardian_partial = {:partial => "guardian_relationship"}
    != "var guardian_relationship ='#{generate_template(f, :relationships, guardian_partial)}'"

  

  %h3= t("terms.register.#{@wizard.current_step}")
  .frm-section.nested-context
    %h4= t('terms.guardianship')
    =render "guardian_relationship_buttons" , :locals => {:item => "guardian_relationship"}
  
  
  -if patient_has_one_parent_and_person_is_not_parent(@patient,@person)
    =f.fields_for :relationships do |relationship_form|
      =render "set_patient_parents", :f => relationship_form

  -elsif @patient.parents.size == 2
    =f.fields_for parent_relationship_type(@patient, @person), @patient.parents_relationship do |relationship_form|
      =render "edit_parents_relationship", :f => relationship_form
  
  = render "person_information", :locals => {:form_builder => f}
  

  .frm-section.nested-context
    %h4= t('terms.spouses')
    .spouse
    %hr.break
    = link_to t('actions.add_spouse'), '#spouse_relationship', :class => "add_nested_item {item : 'spouse_relationship'} button small blue"


  .field.inp-btn
    %span
      = f.submit :value => t('actions.save'),  :class => 'button green'